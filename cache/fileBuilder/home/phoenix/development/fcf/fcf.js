!function(){var fcf={},a_str,a_blockPosition,key;function _fcfGlobals(){return this}if(fcf.NDetails={},fcf.tools={},fcf.isServer=(()=>"object"==typeof module&&void 0!==module.filename),fcf.isServer()){var libFS=require("fs"),libNet=require("net"),libChildProcess=require("child_process");fcf.settings={innerRoot:process.cwd(),outerRoot:"/",libraries:{fcf:""}}}else fcf.settings={innerRoot:"",outerRoot:"/",routeAliases:{},libraries:{fcf:""}};fcf.id=(()=>{for(var result="",i=0;i<32;++i)result+=Math.floor(16*Math.random()).toString(16);return result}),fcf.NDetails.translations=void 0,fcf.t=((a_txt,a_lang)=>{if(fcf.isServer()){var translations=fcf.NTools.cache.get("fcf","translations"),context=fcf.getContext(),variables=fcf.NTools.cache.get("fcf","variables"),lang=void 0!==a_lang?a_lang:context?context.get("language"):variables&&variables.defaultLanguage?variables.defaultLanguage:"en";return translations&&translations[lang]&&translations[lang][a_txt]?translations[lang][a_txt]:a_txt}void 0===fcf.NDetails.translations&&fcf.loadObject({path:"/fcfpackages/fcf/Translations.js",async:!1}).then(a_data=>{fcf.NDetails.translations=a_data});lang=a_lang||fcf.getContext().get("language");return fcf.NDetails.translations[lang]&&fcf.NDetails.translations[lang][a_txt]?fcf.NDetails.translations[lang][a_txt]:a_txt}),fcf.wrap=((a_arrOrObject,a_left,a_right)=>{let result=Array.isArray(a_arrOrObject)?[]:{};return fcf.each(a_arrOrObject,(a_key,a_value)=>{let value=fcf.str(a_left)+a_value+fcf.str(a_right);Array.isArray(a_arrOrObject)?result.push(value):result[a_key]=value}),result}),fcf.escapeQuotes=(a_ctxt=>{var rc,result="";a_ctxt=fcf.str(a_ctxt);for(var i=0;i<a_ctxt.length;++i){switch(a_ctxt[i]){case'"':rc='\\"';break;case"'":rc="\\'";break;default:rc=a_ctxt[i]}result+=rc}return result}),fcf.escapeChar=((a_ctxt,a_char)=>{var rc,result="";a_ctxt=fcf.str(a_ctxt);for(var i=0;i<a_ctxt.length;++i){switch(a_ctxt[i]){case a_char:rc="\\"+a_char;break;case"\\"+a_char:rc="\\\\"+a_char;break;default:rc=a_ctxt[i]}result+=rc}return result}),fcf.unescape=(a_ctxt=>{if("string"!=typeof a_ctxt)return a_ctxt;for(var result="",counter=0,i=0;i<a_ctxt.length;++i){var c=a_ctxt[i];"\\"==c?++counter%2==0&&(result+=c):(counter=0,result+=c)}return result}),fcf.unescapeObject=(a_item=>{let uco=a_item=>{if(Array.isArray(a_item))for(var key=0;key<a_item.length;++key)"object"==typeof a_item[key]?uco(a_item[key]):a_item[key]=fcf.unescape(a_item[key]);else for(var key in a_item)"object"==typeof a_item[key]?uco(a_item[key]):a_item[key]=fcf.unescape(a_item[key]);return a_item};return"object"==typeof a_item?uco(a_item):fcf.unescape(a_item)}),fcf.encodeHtml=(a_ctxt=>{var rc,result="";"object"==typeof(a_ctxt=void 0===a_ctxt||null===a_ctxt?"":a_ctxt)?a_ctxt=JSON.stringify(a_ctxt):"string"!=typeof a_ctxt&&(a_ctxt=fcf.str(a_ctxt));for(var i=0;i<a_ctxt.length;++i){switch(a_ctxt[i]){case"<":rc="&lt;";break;case">":rc="&gt;";break;case'"':rc="&quot;";break;case"'":rc="&#39;";break;default:rc=a_ctxt[i]}result+=rc}return result}),fcf.decodeHtml=((a_ctxt,a_parseObject)=>{if("string"!=typeof a_ctxt)return a_ctxt;var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};for(var k in map)a_ctxt=fcf.replaceAll(a_ctxt,map[k],k);if(a_parseObject&&a_ctxt.length>=2&&("{"===a_ctxt.charAt(0)&&"}"===a_ctxt.charAt(a_ctxt.length-1)||"["===a_ctxt.charAt(0)&&"]"===a_ctxt.charAt(a_ctxt.length-1)))try{a_ctxt=JSON.parse(a_ctxt)}catch(e){}return a_ctxt}),fcf.tagRemoval=(a_txt=>{if("string"!=typeof a_txt)return a_txt;var reg=new RegExp("(<[^>]*>)","g");return a_txt.replace(reg,"")}),fcf.styleElement=((a_property,a_value)=>{if(void 0===a_value||null===a_value||""===a_value)return"";return-1!=["left","top","bottom","right","width","min-width","max-width","height","min-height","max-height"].indexOf(a_property)&&-1==fcf.str(a_value).search(/([^\.0-9])/)&&(a_value+="px"),a_property+": "+a_value+";"}),fcf.replaceAll=((a_str,a_search,a_replacement)=>{return void 0===a_str||null===a_str?"":-1==a_str.indexOf(a_search)?a_str:a_str.split(a_search).join(a_replacement)}),fcf.count=(a_object=>{if(Array.isArray(a_object))return a_object.length;if("object"==typeof a_object){var count=0;for(var k in a_object)++count;return count}return"string"==typeof a_object?a_object.length:0}),fcf.append=((...args)=>{var startArg="boolean"==typeof args[0]?1:0,req="boolean"==typeof args[0]&&args[0];if(Array.isArray(args[startArg])){for(var j=startArg+1;j<args.length;++j)if(args[j])if(req)for(var i=0;i<args[j].length;++i){var itm=null===args[j][i]?null:Array.isArray(args[j][i])?fcf.append(!0,[],args[j][i]):"object"==typeof args[j][i]?fcf.append(!0,Object.create(Object.getPrototypeOf(args[j][i])),args[j][i]):args[j][i];args[startArg].push(itm)}else for(i=0;i<args[j].length;++i)args[startArg].push(args[j][i])}else if("object"==typeof args[startArg])for(j=startArg+1;j<args.length;++j)if(args[j]){var prop=Object.getOwnPropertyNames(args[j]);for(var pkey in prop){var key=prop[pkey];req&&"object"==typeof args[j][key]&&null!==args[j][key]?(args[startArg][key]||(args[startArg][key]=Array.isArray(args[j][key])?[]:Object.create(Object.getPrototypeOf(args[j][key]))),fcf.append(!0,args[startArg][key],args[j][key])):args[startArg][key]=args[j][key]}}return args[startArg]}),fcf.clone=(a_object=>null===a_object?null:Array.isArray(a_object)?fcf.append(!0,[],a_object):"object"==typeof a_object?fcf.append(!0,Object.create(Object.getPrototypeOf(a_object)),a_object):a_object),fcf.insertBeforeByValue=((a_object,a_insertItems,a_search)=>{if("object"!=typeof a_object&&"string"!=typeof a_object)return a_object;var result=Array.isArray(a_object)?[]:"object"==typeof a_object?{}:"",isSrcFn="function"==typeof a_search,isInsertComplete=!1;if(Array.isArray(a_object)||"string"!=typeof a_object)for(var i=0;i<a_object.length;++i)isSrcFn?!isInsertComplete&&a_search(i,a_object[i])&&(fcf.append(result,a_insertItems),isInsertComplete=!0):isInsertComplete||a_object[i]!=a_search||(fcf.append(result,a_insertItems),isInsertComplete=!0),result.push(a_object[i]);else for(var i in a_object)isSrcFn?!isInsertComplete&&a_search(i,a_object[i])&&(fcf.append(result,a_insertItems),isInsertComplete=!0):isInsertComplete||a_object[i]!=a_search||(fcf.append(result,a_insertItems),isInsertComplete=!0),result[i]=a_object[i];return result}),fcf.removeByValue=((a_object,a_value)=>{if(Array.isArray(a_object)){for(var rmKeys=[],i=0;i<a_object.length;++i)fcf.equal(a_object[i],a_value)&&rmKeys.push(i);for(i=0;i<rmKeys.length;++i)a_object.splice(rmKeys[i]-i,1)}else if("object"==typeof a_object){rmKeys=[];for(var i in a_object)fcf.equal(a_object[i],a_value)&&rmKeys.push(i);for(i=0;i<rmKeys.length;++i)delete a_object[rmKeys[i]]}}),fcf.prepareObject=((a_root,a_objectPath)=>{for(var items=(a_objectPath=a_objectPath.split("/").join(".")).split("."),obj=a_root,i=0;i<items.length;++i)items[i]in obj||(obj[items[i]]={}),obj=obj[items[i]];return obj}),fcf.isEnumerable=(a_object=>fcf.isServer()?Array.isArray(a_object):Array.isArray(a_object)||a_object instanceof DOMTokenList||a_object instanceof NodeList),fcf.find=((a_obj,a_cb)=>{if("function"==typeof a_cb){if(fcf.isEnumerable(a_obj)){for(var i=0;i<a_obj.length;++i)if(a_cb(i,a_obj[i]))return i}else if("object"==typeof a_obj)for(var k in a_obj)if(a_cb(k,a_obj[k]))return k}else if(fcf.isEnumerable(a_obj)){for(i=0;i<a_obj.length;++i)if(a_cb==a_obj[i])return i}else if("object"==typeof a_obj)for(var k in a_obj)if(a_cb==a_obj[k])return k}),fcf.each=fcf.foreach=((...args)=>{let a_obj=args[0],a_cb=args[1];var result=void 0;if("function"==typeof args[1]){if(fcf.isEnumerable(a_obj))for(var i=0;i<a_obj.length&&void 0===(result=a_cb(i,a_obj[i]));++i);else if("object"==typeof a_obj){for(var k in a_obj)if(void 0!==(result=a_cb(k,a_obj[k])))break}else if("string"==typeof a_obj)for(i=0;i<a_obj.length&&void 0===(result=a_cb(i,a_obj[i]));++i);}else{for(args=[void 0,void 0],i=1;i<args.length;++i)i==args.length-1?a_cb=args[i]:args.push(args[i]);if(fcf.isEnumerable(a_obj))for(i=0;i<a_obj.length&&(args[0]=i,args[1]=a_obj[i],void 0===(result=a_cb.apply(this,args)));++i);else if("object"==typeof a_obj){for(var k in a_obj)if(args[0]=i,args[1]=a_obj[i],void 0!==(result=a_cb.apply(this,args)))break}else if("string"==typeof a_obj)for(i=0;i<a_obj.length&&(args[0]=i,args[1]=a_obj[i],void 0===(result=a_cb.apply(this,args)));++i);}return result}),fcf.map=((a_object,a_cb)=>{var result={};return fcf.each(a_object,function(a_key,a_value){var itm=a_cb(a_key,a_value);Array.isArray(itm)?result[itm[0]]=itm[1]:fcf.append(result,itm)}),result}),fcf.filter=((a_object,a_cb)=>{var result={};return fcf.each(a_object,(k,v)=>{a_cb(k,v)&&(result[k]=v)}),result}),fcf.array=((a_object,a_cb)=>{var result=[];return fcf.each(a_object,(a_key,a_value)=>{var itm=a_cb(a_key,a_value);void 0!==itm&&result.push(itm)}),result}),fcf.max=((a_left,a_right)=>a_left>a_right?a_left:a_right),fcf.min=((a_left,a_right)=>a_left<a_right?a_left:a_right),fcf.range=((a_value,a_left,a_right,a_default)=>(a_left=parseFloat(a_left),a_left=isNaN(a_left)?Number.MIN_VALUE:a_left,a_right=parseFloat(a_right),a_right=isNaN(a_right)?Number.MAX_VALUE:a_right,a_value=parseFloat(a_value),isNaN(a_value)&&void 0!==a_default?a_default:(a_value=isNaN(a_value)?a_left:a_value)<=a_left&&void 0===a_default?a_left:a_value<=a_left&&void 0!==a_default?a_default:a_value>=a_right&&void 0===a_default?a_right:a_value>=a_right&&void 0!==a_default?a_default:a_value)),fcf.inc=((a_value,a_incArg)=>{a_incArg=parseFloat(a_incArg),isNaN(a_incArg)&&(a_incArg=1);var val=parseFloat(a_value);return isNaN(val)?a_value:val+a_incArg}),fcf.first=(a_object=>{if(Array.isArray(a_object))return a_object[0];if("object"!=typeof a_object)return"string"==typeof a_object?a_object.charAt(0):void 0;for(var k in a_object)return a_object[k]}),fcf.firstKey=(a_object=>{if(Array.isArray(a_object))return a_object.length?0:void 0;if("object"!=typeof a_object)return"string"==typeof a_object&&a_object.length?0:void 0;for(var k in a_object)return k}),fcf.first2=((a_object,a_default)=>{var res=fcf.first(fcf.first(a_object));return void 0===res?a_default:res}),fcf.last=(a_object=>{if(Array.isArray(a_object)||"undefined"!=typeof DOMRectList&&a_object instanceof DOMRectList)return a_object.length?a_object[a_object.length-1]:void 0;if("object"==typeof a_object){var last;for(var k in a_object)last=a_object[k];return last}return"string"==typeof a_object?a_object.length?a_object.charAt(a_object.length-1):"":void 0}),fcf.last2=((a_object,a_default)=>{var res=fcf.last(fcf.last(a_object));return void 0===res?a_default:res}),fcf.byteCount=(a_string=>{for(var result=0,i=0;i<a_string.length;++i)result+=Math.floor(Math.log(a_string.charCodeAt(i))/Math.log(2)/8)+1;return result}),fcf.empty=(a_object=>{if(a_object instanceof Error)return!1;if(void 0===a_object||null===a_object)return!0;if("string"==typeof a_object)return""==a_object;if(Array.isArray(a_object))return 0===a_object.length;if(!fcf.isServer()&&a_object instanceof NodeList)return 0===a_object.length;if("object"==typeof a_object){for(var k in a_object)return!1;return!0}return"number"==typeof a_object&&isNaN(a_object)}),fcf.in=((a_obj,a_value)=>{if(Array.isArray(a_obj)){if(Array.isArray(a_value)){for(var i=0;i<a_obj.length;++i)for(var j=0;j<a_value.length;++j)if(a_obj[i]==a_value[j])return!0}else if("object"==typeof a_value){for(i=0;i<a_obj.length;++i)for(var j in a_value)if(a_obj[i]==a_value[j])return!0}else for(i=0;i<a_obj.length;++i)if(a_obj[i]==a_value)return!0}else if("object"==typeof a_obj){if(Array.isArray(a_value)){for(var k in a_obj)for(j=0;j<a_value.length;++j)if(a_obj[k]==a_value[j])return!0}else if("object"==typeof a_value){for(var k in a_obj)for(var j in a_value)if(a_obj[k]==a_value[j])return!0}else for(var k in a_obj)if(a_obj[k]==a_value)return!0}else if("string"==typeof a_obj)return-1!==a_obj.indexOf(a_value);return!1}),fcf.indexOfAll=((a_arr,a_val)=>{for(var result=[],i=-1;-1!=(i=a_arr.indexOf(a_val,i+1));)result.push(i);return result}),fcf.splitSpace=(a_ctxt=>{for(var result=[],empty=!0,beg=0,i=0;i<a_ctxt.length;++i){var code=a_ctxt.charCodeAt(i);!empty&&code<=32&&code>=0?(result.push(a_ctxt.substr(beg,i-beg)),empty=!0):(empty&&(beg=i),empty=!1)}return empty||result.push(a_ctxt.substr(beg,a_ctxt.length-beg)),result}),fcf.ltrimPos=((a_str,a_arr)=>{for(var pos=0;pos<a_str.length;++pos)if(Array.isArray(a_arr)){for(var found=!1,i=0;i<a_arr.length;++i)if(a_str.charAt(pos)==a_arr[i]){found=!0;break}if(!found)break}else if(void 0!==a_arr){if(a_str.charAt(pos)!=a_arr)break}else{var code=a_str.charCodeAt(pos);if(code>32||code<0)break}return pos}),fcf.rtrimPos=((a_str,a_arr)=>{if(!a_str.length)return 0;for(var pos=a_str.length-1;pos>=0;--pos)if(Array.isArray(a_arr)){for(var found=!1,i=0;i<a_arr.length;++i)if(a_str.charAt(pos)==a_arr[i]){found=!0;break}if(!found)break}else if(void 0!==a_arr){if(a_str.charAt(pos)!=a_arr)break}else{var code=a_str.charCodeAt(pos);if(code>32||code<0)break}return pos+1}),fcf.ltrim=((a_str,a_arr)=>{var pos=fcf.ltrimPos(a_str,a_arr);return 0!=pos?a_str.substr(pos):a_str}),fcf.rtrim=((a_str,a_arr)=>{var pos=fcf.ltrimPos(a_str,a_arr);return pos!=a_str.length?a_str.substr(0,pos):a_str}),fcf.trim=((a_str,a_arr)=>{a_str=fcf.str(a_str);var posBeg=fcf.ltrimPos(a_str,a_arr),posEnd=fcf.rtrimPos(a_str,a_arr);return 0!=posBeg||posEnd!=a_str.length?a_str.substr(posBeg,posEnd-posBeg):a_str}),fcf.str=(a_data=>void 0===a_data?"":null===a_data?"":NaN===a_data?"":a_data instanceof fcf.RenderResults?a_data.toString():a_data instanceof fcf.Exception?a_data.toString():"object"==typeof a_data&&a_data.sqlMessage&&a_data.sqlState&&a_data.code?a_data.sqlMessage:"object"==typeof a_data&&a_data.message?a_data.message:"object"==typeof a_data?JSON.stringify(a_data,void 0,2):"string"!=typeof a_data?a_data.toString():a_data),fcf.strToObject=(a_data=>{let result=a_data;if("string"==typeof result)try{"["!=result.charAt(0)&&"{"!=result.charAt(0)||(result=JSON.parse(result))}catch(e){}return result}),fcf.merge=((a_dst,a_value,a_options)=>{var type=a_options&&a_options.type?a_options.type:"append";if(a_dst=fcf.append(!0,{},a_dst),"append"==type){if(Array.isArray(a_value)){var buf={},order=a_options&&!fcf.empty(a_options.position)?a_options.position:-1;order<0&&(order=a_dst.length);for(var i=0;i<a_value.length;++i){var o="object"==typeof a_value[i]&&"mergePosition"in a_value[i]?a_value[i].mergePosition:order;buf[o]||(buf[o]=[]),buf[o].push(a_value[i])}for(i=0;i<a_dst.length;++i)buf[i]||(buf[i]=[]),buf[i].push(a_dst[i]);var result=[];for(var k in buf)for(i=0;i<buf[k].length;++i)result.push(buf[k][i]);return result}if("object"==typeof a_value)return fcf.append(a_dst,a_value)}}),fcf.buildModeObject=((a_mode,a_object,a_fieldModeNames)=>{a_fieldModeNames||(a_fieldModeNames="usage");var result=fcf.append({},a_object),obj="object"==typeof a_object[a_fieldModeNames]?a_object[a_fieldModeNames][fcf.getMode(a_mode,a_object[a_fieldModeNames])]:void 0;return obj&&fcf.append(result,obj),result}),fcf.getModeObject=((a_mode,a_modesObject,a_default)=>{if(!a_modesObject)return a_default;var result=a_modesObject[fcf.getMode(a_mode,a_modesObject)];return void 0!==result?result:a_default}),fcf.cutMode=((a_mode,a_cut)=>{let res="",modeArr=a_mode.split(".");for(let i=0;i<a_cut;++i)res+=(0!==i?".":"")+modeArr[i];return res}),fcf.getMode=((a_mode,a_modesObject)=>{if(a_modesObject){var arrMode=(a_mode="string"==typeof a_mode?a_mode:"").split("."),lstMode=void 0,lstWeight=-1;for(var mode in a_modesObject){var coincidence=!0,arrTmpl=mode.split("."),weight=Number.MAX_VALUE;if(!(arrTmpl.length>arrMode.length)){for(var i=0;i<arrMode.length;++i){if(i>=arrTmpl.length){0!=i&&"*"==arrTmpl[i-1]||(coincidence=!1);break}if("*"!=arrTmpl[i]&&arrTmpl[i]!=arrMode[i]){coincidence=!1;break}"*"==arrTmpl[i]&&(weight=i)}coincidence&&lstWeight<weight&&(lstMode=mode,lstWeight=weight)}}return lstMode}}),fcf.getVariablesFromCode=(a_str=>{if("string"!=typeof a_str)return[];var re=new RegExp("([_a-z][_a-z0-9]*\\[['\"][^'\"]*['\"]\\]\\[['\"][^'\"]*['\"]\\])|([_a-z][_a-z0-9]*\\.[_a-z][_a-z0-9]*\\[['\"][^'\"]*['\"]\\])|([_a-z][_a-z0-9]*\\[['\"][^'\"]*['\"]\\]\\.[_a-z][_a-z0-9]*)|([_a-z][_a-z0-9]*\\.[_a-z][_a-z0-9]*\\.[_a-z][_a-z0-9]*)|([_a-z][_a-z0-9]*\\.[_a-z][_a-z0-9]*)|([_a-z][_a-z0-9]*\\[['\"][^'\"]*['\"]\\])|([_a-z][_a-z0-9]*)","gi"),res=a_str.match(re);return Array.isArray(res)||(res=[]),res}),fcf.getVariablesString=(a_str=>{let findBlockBegin=(a_str,a_pos)=>{for(var result={type:"",pos:-1};;){if(-1==(a_pos=a_str.indexOf("{{",a_pos)))return result;if(0!=a_pos){var type=a_str[a_pos-1];if(a_pos>=2&&"\\"==a_str[a_pos-2])a_pos+=2;else{if("$"==type||"#"==type||"@"==type)return result.pos=a_pos-1,result.type=type,result;a_pos+=2}}else a_pos+=2}};var result=[];if("string"!=typeof a_str)return result;for(var pos=0;;){var blockBegin=findBlockBegin(a_str,pos);if(-1==blockBegin.pos)return result;var blockEndPos=a_str.indexOf("}}"+blockBegin.type,blockBegin.pos+3);if(-1==blockEndPos)return result;if(pos=blockEndPos+3,"$"==blockBegin.type||"#"==blockBegin.type)result.push(fcf.trim(a_str.substr(blockBegin.pos+3,blockEndPos-blockBegin.pos-3)));else if("@"==blockBegin.type){var code=a_str.substr(blockBegin.pos+3,blockEndPos-blockBegin.pos-3);fcf.append(result,fcf.getVariablesFromCode(code))}}return result}),fcf.getRouteVariablesByString=(a_str=>{for(var result=[],vars=fcf.getVariablesString(a_str),i=0;i<vars.length;++i){var item=fcf.parseObjectAddress(vars[i]);"route"!=item[0]||"args"!=item[1]||fcf.empty(item[2])||result.push(item[2])}return result}),fcf.getRouteVariablesBySource=(a_object=>fcf.isArg(a_object)?fcf.getRouteVariablesByString(a_object.value):[]),fcf.unslash=(a_txt=>{for(var res="",slashCounter=0,i=0;i<a_txt.length;++i){var c=a_txt.charAt(i);"\\"===c?(slashCounter%2!=0&&(res+=c),++slashCounter):(slashCounter=0,res+=c)}return res}),fcf.pattern=((a_str,a_object,a_refInfo)=>{a_object||(a_object={});try{if("string"==typeof a_str)return fcf._pattern(a_str,a_object,a_refInfo);if("object"==typeof a_str){a_str=fcf.clone(a_str);return fcf.each(a_str,(k,v)=>{a_str[k]=fcf.pattern(a_str[k],a_object,a_refInfo)}),a_str}return a_str}catch(e){return""}}),fcf._pattern=((a_str,a_object,a_refInfo)=>{(a_refInfo=a_refInfo||{}).references||(a_refInfo.references={});var result="",buff="",state=0,rmode=0,start=void 0;a_str=fcf.str(a_str);for(var i=0;i<a_str.length;++i){var c=a_str.charAt(i);if(0==state)"$"==c?(start=i,state=1,rmode=1):"@"==c?(start=i,state=1,rmode=2):"&"==c?(start=i,state=1,rmode=3):"!"==c?(start=i,state=1,rmode=4):result+=c;else if(1==state)"{"==c?(state=2,buff=""):(result+=(1==rmode?"$":2==rmode?"@":3==rmode?"&":"!")+c,state=0);else if(2==state)if("}"==c)if(1==rmode&&"$"==a_str.charAt(i+1)){if(state=0,0==start&&i==a_str.length-2)return fcf.resolve(a_object,buff);result+=fcf.str(fcf.resolve(a_object,buff)),++i}else if(2==rmode&&"@"==a_str.charAt(i+1)){if(state=0,0==start&&i==a_str.length-2)return fcf.safeEvalResult(buff,a_object);result+=fcf.str(fcf.safeEvalResult(buff,a_object)),++i}else if(3==rmode&&"&"==a_str.charAt(i+1)){state=0;var refPathArr=fcf.parseObjectAddress(buff),refPathArrFirst=refPathArr[0];refPathArr.shift();for(var fullRef=a_refInfo.references[refPathArrFirst],j=0;j<refPathArr.length;++j)fullRef+='["'+refPathArr[j]+'"]';var ref=fcf.arg("reference",{id:a_refInfo.id,arg:fullRef});if(0==start&&i==a_str.length-2)return ref;result+=fcf.str(ref),++i}else 4==rmode&&"!"==a_str.charAt(i+1)?(state=0,"{"==buff[0]&&"}"==buff[buff.length-1]&&(buff=buff.substr(1,buff.length-2)),result+=fcf.t(buff),++i):buff+=c;else buff+=c}return result}),fcf.tokenize=((a_ctxtptr,a_obj,a_escape)=>{if(a_ctxtptr instanceof fcf.StringPointer)return fcf._tokenizePtrEx(ctxtptr,a_obj,a_escape).data;if("object"==typeof a_ctxtptr)return a_ctxtptr=fcf.clone(a_ctxtptr),fcf.each(a_ctxtptr,(k,v)=>{a_ctxtptr[k]=fcf.tokenize(v,a_obj,a_escape)}),a_ctxtptr;if("string"==typeof a_ctxtptr){var ctxtptr=new fcf.StringPointer(a_ctxtptr);return fcf._tokenizePtrEx(ctxtptr,a_obj,a_escape).data}return a_ctxtptr}),fcf.tokenizeObject=((a_object,a_args,a_escape)=>{var result=Array.isArray(a_object)?[]:Object.create(Object.getPrototypeOf(a_object));if(Array.isArray(a_object))for(var i=0;i<a_object.length;++i){var v=a_object[i];result[i]="object"==typeof v&&null!==v?fcf.tokenizeObject(v,a_args,a_escape):"string"==typeof v?fcf.tokenize(v,a_args,a_escape):v}else for(var k in a_object){"object"==typeof(v=a_object[k])&&null!==v?("string"==typeof k&&(k=fcf.tokenize(k,a_args,a_escape)),result[k]=fcf.tokenizeObject(v,a_args,a_escape)):"string"==typeof v?("string"==typeof k&&(k=fcf.tokenize(k,a_args,a_escape)),result[k]=fcf.tokenize(v,a_args,a_escape)):("string"==typeof k&&(k=fcf.tokenize(k,a_args,a_escape)),result[k]=v)}return result}),fcf.tokenizeEx=((a_ctxtptr,a_obj,a_escape)=>{var ctxtptr="object"==typeof a_ctxtptr?a_ctxtptr:new fcf.StringPointer(a_ctxtptr);return fcf._tokenizePtrEx(ctxtptr,a_obj,a_escape)}),fcf._tokenizePtrEx=((a_ctxtptr,a_obj,a_escape)=>{var result={data:"",noComplete:!1,replace:!1};let clFindSubstitution=(a_str,a_startPos)=>{for(var result={beg:void 0,end:void 0,type:void 0},emptyResult={beg:void 0,end:void 0,type:void 0},escCnt=0,state=0,i=a_startPos;i<a_str.length;++i){var c=a_str[i];if(a_escape&&escCnt%2!=0||0!=state){if(1==state)state="{"==c?2:0;else if(2==state)state="{"==c?3:0;else if(3==state)"}"==c&&(state=4);else if(4==state)state="}"==c?5:3;else if(5==state){if(c==result.type)return result.end=i+1,result;state=3}}else"@"!=c&&"#"!=c&&"$"!=c&&"!"!=c||(result.type=c,result.beg=i,state=1);"\\"==c?++escCnt:escCnt=0}return emptyResult},clResolveData=(a_str,a_blockPosition)=>{var key=a_str.substr(a_blockPosition.beg+3,a_blockPosition.end-a_blockPosition.beg-6);return fcf.resolveEx(a_obj,key)},clResolveCode=(a_str,a_blockPosition)=>{var result,code=a_str.substr(a_blockPosition.beg+3,a_blockPosition.end-a_blockPosition.beg-6);try{result=fcf.safeEvalResult("("+code+")",a_obj)}catch(e){return{object:void 0,key:void 0}}return void 0===result?{object:void 0,key:void 0}:"number"==typeof result&&isNaN(result)?{object:void 0,key:void 0}:{object:{result:result},key:"result"}};for(var pos=a_ctxtptr.pos,str=a_ctxtptr.fullStr();void 0!==pos;){var blockPosition=clFindSubstitution(str,pos),item=str.substr(pos,void 0!==blockPosition.beg?blockPosition.beg-pos:str.length-pos);if(""!==item&&(result.data+=item),void 0!==blockPosition.beg)if("$"==blockPosition.type)(retSubstitution=(a_blockPosition=blockPosition,key=void 0,key=(a_str=str).substr(a_blockPosition.beg+3,a_blockPosition.end-a_blockPosition.beg-6),fcf.resolveEx(a_obj,key))).object?(result.data=fcf.str(result.data)+fcf.str(retSubstitution.object[retSubstitution.key]),result.replace=!0):(result.data+=str.substr(blockPosition.beg,blockPosition.end-blockPosition.beg),result.noComplete=!0);else if("#"==blockPosition.type){(retSubstitution=clResolveData(str,blockPosition)).object?(result.data=0==blockPosition.beg&&blockPosition.end==str.length?retSubstitution.object[retSubstitution.key]:fcf.str(result.data)+retSubstitution.object[retSubstitution.key],result.replace=!0):(result.data+=str.substr(blockPosition.beg,blockPosition.end-blockPosition.beg),result.noComplete=!0)}else if("@"==blockPosition.type){var retSubstitution;(retSubstitution=clResolveCode(str,blockPosition)).object?(result.data=0==blockPosition.beg&&blockPosition.end==str.length?retSubstitution.object[retSubstitution.key]:fcf.str(result.data)+retSubstitution.object[retSubstitution.key],result.replace=!0):(result.data+=str.substr(blockPosition.beg,blockPosition.end-blockPosition.beg),result.noComplete=!0)}else"!"==blockPosition.type&&(result.data+=fcf.t(str.substr(blockPosition.beg+3,blockPosition.end-blockPosition.beg-6)),result.replace=!0);pos=blockPosition.end}return result}),fcf.normalizeObjectAddress=(a_path=>{for(var key,arr=fcf.parseObjectAddress(a_path),result="",i=0;i<arr.length;++i)key=fcf.replaceAll(arr[i],"\\","\\\\"),result+='["'+(key=fcf.replaceAll(key,'"','\\"'))+'"]';return result}),fcf.getObjectAddressItem=((a_path,a_numIndex)=>{for(var key,arr=fcf.parseObjectAddress(a_path),result="",i=0;i<arr.length&&i<=a_numIndex;++i)key=fcf.replaceAll(arr[i],"\\","\\\\"),key=fcf.replaceAll(key,'"','\\"'),""!=result&&(result+="."),result+='["'+key+'"]';return result});class fcfStringPointer{constructor(a_string){this._str=a_string,this.pos=0,this.posend=this._str.length}clone(){return fcf.append({},this)}fullStr(){return this._str}str(){return this._str.substr(this.pos,this.posend-this.pos)}indexOf(a_ctx,a_startPos){if(-1===a_startPos)return-1;var startPos=void 0!==a_startPos?a_startPos:this.pos,result=-1;if("string"==typeof a_ctx)result=this._str.indexOf(a_ctx,startPos);else for(var i=startPos;i<this.posend;++i)for(var char=this._str.charAt(i),j=0;j<a_ctx.length;++j)if(a_ctx[j]==char&&(-1===result||i<result)){result=i;break}return result>=this.posend?-1:result}indexOfSpace(a_startPos){if(-1===a_startPos)return-1;for(var i=void 0!==a_startPos?a_startPos:this.pos;i<this.posend;++i){var code=this._str.charCodeAt(i);if(code<=32&&code>0)return i}return-1}end(){return this.pos>=this.posend}ltrim(a_arr){var startPos=this.pos;if(void 0===a_arr)for(;!this.end();){var code=this._str.charCodeAt(this.pos);if(code<=32&&code>0)break;++this.pos}else{var br=!1;for(a_arr=Array.isArray(a_arr)?a_arr:[a_arr];!this.end();){for(var char=this._str.charAt(this.pos),i=0;i<a_arr.length;++i)char==a_arr[i]&&(br=!0);if(br)break;++this.pos}}return this._str.substr(startPos,this.pos-startPos)}}fcf.StringPointer=fcfStringPointer,fcf.parseObjectAddressEx=(a_path=>{var path=new fcf.StringPointer(a_path);return fcf._parseObjectAddressEx(path)}),fcf._parseObjectAddressEx=(a_path=>{var result=[];let readSimple=()=>{for(var buf="";a_path.pos<a_path.posend;){var c=a_path._str[a_path.pos];if("."==c||"["==c||"]"==c)break;buf+=c,++a_path.pos}result.push(buf)},readArr=()=>{var buf="";(()=>{for(;a_path.pos<a_path.posend&&a_path._str[a_path.pos].charCodeAt(0)<=32;)++a_path.pos})();var quote=('"'==(c=a_path._str[a_path.pos])||"'"==c)&&c;if(quote){++a_path.pos;for(var slash=0;a_path.pos<a_path.posend;){if((c=a_path._str[a_path.pos])==quote&&slash%2==0){++a_path.pos;break}"\\"===c?++slash:slash=0,buf+=c,++a_path.pos}for(buf=fcf.replaceAll(buf,"\\\\","\\"),buf=fcf.replaceAll(buf,"\\"+quote,quote);a_path.pos<a_path.posend;){var c;if("]"==(c=a_path._str[a_path.pos])){++a_path.pos;break}++a_path.pos}result.push(buf)}else result.push(fcf._parseObjectAddressEx(a_path))};for(;a_path.pos<a_path.posend;){var p=a_path.pos,c=a_path._str[a_path.pos];if("]"==c)break;"."!=c?("["==c?(++a_path.pos,readArr()):readSimple(),p==a_path.pos&&++a_path.pos):++a_path.pos}for(var i=0;i<result.length;++i)result[i]=result[i].replace("\\[","[").replace("\\]","]");return result}),fcf.parseObjectAddress=(a_path=>{for(var state=0,key="",result=[],slashCounterMode=!1,i=0;i<a_path.length;++i){var newState=state,c=a_path[i];if(0===state)"["===c?newState=1:"."===c&&(newState=4);else if(1===state)"'"===c?newState=2:'"'===c?newState=3:"]"===c&&(newState=5);else if(2===state)"'"===c&&(slashCounterMode||(newState=6));else if(3===state)'"'===c&&(slashCounterMode||(newState=7));else if(5===state){if("["===c)newState=1;else if("."===c){newState=0,state=0;continue}}else 6===state?"]"===c&&(newState=5):7===state&&"]"===c&&(newState=5);slashCounterMode="\\"==c&&!slashCounterMode,newState==state&&newState<4?slashCounterMode||(key+=c):1==newState&&key.length?(result.push(key),key=""):4==newState?(newState=0,result.push(key),key=""):5==newState&&(result.push(key),key=""),state=newState}return""!==key&&result.push(key),result}),fcf.resolveEx=((a_obj,a_path,a_createObj)=>{for(var pathArr=fcf.parseObjectAddress(a_path),result={key:void 0,object:void 0},cur=a_obj,i=0;i<pathArr.length-1;++i){var key,itm;if(Array.isArray(pathArr[i]))key=(itm=fcf.resolveEx(a_obj,pathArr[i],a_createObj)).object[itm.key];else key=pathArr[i];if("object"!=typeof cur[key]){if(!a_createObj)return result;cur[key]={}}cur=cur[key]}Array.isArray(pathArr[pathArr.length-1])?key=(itm=fcf.resolveEx(a_obj,pathArr[pathArr.length-1],a_createObj)).object[itm.key]:key=pathArr[pathArr.length-1];return result.key=key,result.object=cur,result}),fcf.resolve=((a_obj,a_path)=>{if("object"==typeof a_obj){if(Array.isArray(a_path)){for(var cur=a_obj,i=0;i<a_path.length;++i){if("object"!=typeof cur)return;if(!(a_path[i]in cur))return;cur=cur[a_path[i]]}return cur}var state=0,key="",slashCounterMode=(cur=a_obj,!1);for(i=0;i<a_path.length;++i){var newState=state,c=a_path[i];if(0===state)"["===c?newState=1:"."===c&&(newState=4);else if(1===state)"'"===c?newState=2:'"'===c?newState=3:"]"===c&&(newState=5);else if(2===state)"'"===c&&(slashCounterMode||(newState=6));else if(3===state)'"'===c&&(slashCounterMode||(newState=7));else if(5===state){if("["===c)newState=1;else if("."===c){newState=0,state=0;continue}}else 6===state?"]"===c&&(newState=5):7===state&&"]"===c&&(newState=5);if(slashCounterMode="\\"==c&&!slashCounterMode,key.length&&0==state&&1==newState&&(cur=cur[key],key=""),newState==state&&newState<4?slashCounterMode||(key+=c):4==newState?(newState=0,cur=cur[key],key=""):5==newState&&(cur=cur[key],key=""),state=newState,void 0===cur)return}return""!==key&&(cur=cur[key]),cur}}),fcf.padEnd=((a_str,a_len,a_fill)=>{"string"==typeof a_fill&&0!=a_fill.length||(a_fill=" ");var result=a_str;if(result.length>=a_len)return result;for(var с=Math.floor((result.length-a_len)/a_fill.length),i=0;i<с;++i)result+=a_fill;var d=(result.length-a_len)%a_fill.length;return d&&(result+=a_fill.substr(0,d)),result}),fcf.serial=(a_part=>{var sm=fcf.NDetails.serial__map;return a_part in sm||(sm[a_part]=0),++sm[a_part]}),fcf.getLastSerial=(a_part=>{var sm=fcf.NDetails.serial__map;return a_part in sm||(sm[a_part]=0),sm[a_part]}),fcf.NDetails.serial__map={},fcf.uuid=(()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})),fcf.genId=(a_part=>{(""===a_part||!1===a_part||void 0===a_part)&&(a_part=fcf.isServer()?"__fcfserver_":"__fcf_");var id=a_part;return fcf.application&&(id+="_"+(fcf.application&&fcf.application.getSettings()?fcf.application.getSettings().port:0)),id+="_"+Date.now(),id+="_"+fcf.serial(a_part)}),fcf.getLastId=(a_part=>{return(""===a_part||!1===a_part||void 0===a_part)&&(a_part=fcf.isServer()?"__fcfserver_":"__fcf_"),a_part+"_"+fcf.getLastSerial(a_part)}),fcf.NPath={},fcf.NPath.concat=((a_left,a_right)=>a_left&&0!=a_left.length?a_right&&0!=a_right.length?"/"==a_left.slice(-1)?a_left+a_right:a_left+"/"+a_right:a_left:a_right),fcf.hash=(a_str=>{var i,hash=0;if(0===a_str.length)return hash;for(i=0;i<a_str.length;i++)hash=(hash<<5)-hash+a_str.charCodeAt(i),hash|=0;return hash}),fcf.equal=((a_left,a_right)=>!!fcf._equalObject(a_left,a_right)&&fcf._equalObject(a_right,a_left)),fcf._equalObject=((a_left,a_right)=>{if(Array.isArray(a_left)){if(!Array.isArray(a_right))return!1;if(a_left.length!=a_right.length)return!1;for(var i=0;i<a_left.length;++i)fcf.equal(a_left[i],a_right[i])}else if("object"==typeof a_left){if("object"!=typeof a_right)return!1;for(var key in a_left){if(void 0!==a_left[key]&&!(key in a_right))return!1;fcf._equalObject(a_left[key],a_right[key])}}else if(a_left!=a_right)return!1;return!0}),fcf.objects={},fcf.NDetails.objEventCounter=0,fcf.EventChannel=function(a_settings){var self=this;this._owner=a_settings?a_settings.owner:void 0,this._events={},this._processesEvent=[],this.on=function(a_options){if("string"==typeof a_options)if("function"==typeof arguments[1])a_options={name:arguments[0],function:arguments[1],once:!1,globalEvent:!1};else{if("function"!=typeof arguments[2])return;a_options={name:arguments[0],function:arguments[2],once:!1,globalEvent:arguments[1]}}return this.attach.call(this,a_options)},this.once=function(a_options){if("string"==typeof a_options)if("function"==typeof arguments[1])a_options={name:arguments[0],function:arguments[1],once:!0,globalEvent:!1};else{if("function"!=typeof arguments[2])return;a_options={name:arguments[0],function:arguments[2],once:!0,globalEvent:arguments[1]}}return this.attach.call(this,a_options)},this.attach=function(a_options){if("string"==typeof a_options)if("function"==typeof arguments[1])a_options={name:arguments[0],function:arguments[1],once:!1,globalEvent:!1};else if("function"==typeof arguments[2])a_options={name:arguments[0],function:arguments[2],once:arguments[1],globalEvent:!1};else{if("function"!=typeof arguments[3])return;a_options={name:arguments[0],function:arguments[3],once:arguments[1],globalEvent:arguments[2]}}a_options.name in this._events||(this._events[a_options.name]=[]);var level=fcf.range(a_options.level,0,10,5);this._events[a_options.name][level]||(this._events[a_options.name][level]={});var senderId=a_options.sender?this._applyEventObjectId(a_options.sender):this._applyEventObjectId(a_options.object);this._events[a_options.name][level][senderId]||(this._events[a_options.name][level][senderId]={});var lintenerId=void 0,lintenerItemId=void 0,callinfo={};if(a_options.function)lintenerItemId=lintenerId=this._applyEventObjectId(a_options.function),callinfo.function=a_options.function,callinfo.once=a_options.once,callinfo.globalEvent=a_options.globalEvent;else{lintenerId=this._applyEventObjectId(a_options.object);var method=fcf.str(a_options.prefix)+(a_options.suffix?a_options.suffix:"on"+a_options.name.charAt(0).toUpperCase()+a_options.name.slice(1));lintenerItemId=lintenerId+"#"+method,callinfo.object=a_options.object,callinfo.method=method,callinfo.once=a_options.once,callinfo.globalEvent=a_options.globalEvent}lintenerId in this._events[a_options.name][level][senderId]||(this._events[a_options.name][level][senderId][lintenerId]={}),this._events[a_options.name][level][senderId][lintenerId][lintenerItemId]=callinfo},this.detach=function(a_eventName,a_funcOrObject,a_method){if("string"!=typeof a_eventName&&(a_method=a_funcOrObject,a_funcOrObject=a_eventName,a_eventName=void 0),a_eventName){if(!(a_eventName in this._events))return;for(var level=0;level<this._events[a_eventName].length;++level)if(this._events[eventName][level])for(var senderId in this._events[a_eventName][level]){(listenerId=this._applyEventObjectId(a_funcOrObject))in this._events[a_eventName][level][senderId]&&(a_methodName?delete this._events[a_eventName][level][senderId][listenerId][a_methodName]:delete this._events[a_eventName][level][senderId])}}else for(var eventName in this._events)for(level=0;level<this._events[eventName].length;++level)if(this._events[eventName][level])for(var senderId in this._events[eventName][level]){var listenerId;(listenerId=this._applyEventObjectId(a_funcOrObject))in this._events[eventName][level][senderId]&&(a_method?delete this._events[eventName][level][senderId][listenerId][a_method]:delete this._events[eventName][level][senderId])}},this.emit=function(a_event,a_data){return this.send(a_event,a_data)},this.send=function(a_event,a_data){"string"==typeof a_event?a_event=new fcf.Event(a_event,a_data):"object"==typeof a_data&&(a_event=fcf.append(new fcf.Event,a_event,a_data));var name=a_event.name;if(!this._events[name])return fcf.actions();for(var calls=[],level=0;level<this._events[name].length;++level)if(this._events[name][level])for(var senderId in this._events[name][level])for(var listenerId in this._events[name][level][senderId]){var rm=[];for(var listenerItemId in this._events[name][level][senderId][listenerId]){var callinfo=this._events[name][level][senderId][listenerId][listenerItemId];callinfo.function?calls.push({cb:callinfo.function,object:void 0,info:callinfo}):callinfo.object&&callinfo.object[callinfo.method]&&calls.push({cb:callinfo.object[callinfo.method],object:callinfo.object,info:callinfo}),callinfo.once&&rm.push(listenerItemId)}for(var i=0;i<rm.length;++i)delete this._events[name][level][senderId][listenerId][rm[i]]}var actions=fcf.actions();for(i=0;i<calls.length;++i)!function(i){var globalEvent=!1;actions.then(function(){return calls[i].info.globalEvent&&(globalEvent=!0),calls[i].cb.call(calls[i].object,a_event)}).exec(function(a_act){if(globalEvent&&fcf.isServer())if(a_event.prohibitionGlobal)a_act.complete();else{var message=JSON.stringify(a_event);fcf.actions().each(self._processesEvent,function(a_subact,a_key,a_info){if(fcf.application.getControlPort()!=a_info.port||"localhost"!=a_info.host&&"121.0.0.1"!=a_info.host)try{var client=new libNet.Socket;client.connect(a_info.port,a_info.host,function(){try{client.write(message.length+"\n"+message)}catch(e){a_subact.complete()}}),client.on("data",function(a_data){a_subact.complete()}),client.on("error",function(a_data){a_subact.complete()})}catch(e){}else a_subact.complete()}).then(function(){a_act.complete()})}else a_act.complete()})}(i);return actions},this._applyEventObjectId=function(a_obj){if("object"==typeof a_obj||"function"==typeof a_obj)return this._getParamIdName()in a_obj||(a_obj[this._getParamIdName()]=this._getId()),a_obj[this._getParamIdName()]},this.setProcessEnvironment=function(a_processesEvent){this._processesEvent=a_processesEvent},this._getParamIdName=function(){return"_fcfeventchannelid"},this._getId=function(){return fcf.genId("_ec")}},fcf._eventMessages={},fcf.NDetails.amdEventChannel=new fcf.EventChannel,fcf.NDetails.amdModules={},fcf.NDetails.amdWatchFiles={},fcf.NDetails.amdLoader=function(a_sourceName,a_modules,a_options,a_callback,a_exMode){"function"==typeof a_options&&(a_exMode=a_callback,a_callback=a_options,a_options=void 0),a_options||(a_options={}),this._options=fcf.append({showError:!0},a_options),this._sourceName=a_sourceName,this._callback=a_callback,this._modules=a_modules,this._exMode=!!a_exMode,this._complete=!1,this._frid=fcf.genId(),fcf.NDetails.amdEventChannel.attach({name:"load",object:this}),fcf.NDetails.amdEventChannel.attach({name:"fullload",object:this}),fcf.NDetails.amdEventChannel.attach({name:"errorLoad",object:this}),this.load=function(){var state=this._load(this._modules);if("ok"===state.state){if(this._complete)return;var result=[];for(var key in this._exMode&&result.push(void 0),a_modules){var moduleName="object"==typeof a_modules[key]?a_modules[key].module:a_modules[key];result.push(fcf.NDetails.amdModules[moduleName].result)}fcf.NDetails.amdEventChannel.detach(this),this._complete=!0,this._callback(result)}if("error"===state.state){result=[];this._exMode&&result.push(state.state.error),fcf.NDetails.amdEventChannel.detach(this),this._complete=!0,this._callback(result)}},this._load=function(a_modules){var result={state:"ok"};for(var key in a_modules){var moduleName="object"==typeof a_modules[key]?a_modules[key].module:a_modules[key];if(moduleName in fcf.NDetails.amdModules||this._loadData(a_modules[key]),!(moduleName in fcf.NDetails.amdModules&&"ok"==fcf.NDetails.amdModules[moduleName].state)){if(moduleName in fcf.NDetails.amdModules&&"error"==fcf.NDetails.amdModules[moduleName].state){result={state:"error",error:fcf.NDetails.amdModules[moduleName].error};break}result={state:"wait"}}}return result},this._loadData=function(a_module){var error=!1,moduleName="object"==typeof a_module?a_module.module:a_module,moduleUrl="object"==typeof a_module?a_module.url:a_module;if(fcf.NDetails.amdModules[moduleName]={state:"wait",module:void 0},fcf.isServer()){var path=fcf.getPath(moduleUrl);if(libFS.existsSync(path))try{require(path)}catch(except){error=except}else error=new fcf.Exception("ERROR_FILE_NOT_FOUND",{file:path});if(error&&("MODULE_NOT_FOUND"!=error.code&&"ERROR_FILE_NOT_FOUND"!=error.name||(this._sourceName?this._options.showError&&console.error("Can't load module '"+moduleName+"' by path '"+path+"' from source '"+this._sourceName+"'"):this._options.showError&&console.error("Can't load module '"+moduleName+"' by path '"+path+"'")),fcf.NDetails.amdEventChannel.send({name:"errorLoad",uri:moduleName,error:error}),!this._exMode))throw error;if(!error){fcf.NDetails.amdEventChannel.send({name:"load",uri:moduleName});let path=fcf.getPath(moduleName);fcf.NDetails.amdWatchFiles[path]||(fcf.NDetails.amdWatchFiles[path]=!0,libFS.watchFile(path,{interval:1e3},(a_fileName,a_eventName)=>{delete fcf.NDetails.amdModules[moduleName],delete require.cache[path]}))}}else{var script=document.createElement("script");script.onload=function(){moduleName!=fcf.NDetails.amdLastModulesName&&(fcf.NDetails.amdModules[moduleName]=fcf.NDetails.amdModules[fcf.NDetails.amdLastModulesName]),fcf.NDetails.amdEventChannel.send({name:"load",uri:moduleName})},script.onerror=function(){fcf.NDetails.amdEventChannel.send({name:"errorLoad",uri:moduleName,error:new fcf.Exception("ERROR_FILE_NOT_FOUND",{file:moduleName})})},script.src=fcf.getPath(moduleUrl),script.sync=!1,script.async=!0,script.defer=!1,document.head.appendChild(script)}},this.onLoad=function(a_event){this.load()},this.onFullload=function(a_event){this.load()},this.onErrorLoad=function(a_event){fcf.NDetails.amdModules[a_event.uri].state="error",fcf.NDetails.amdModules[a_event.uri].error=a_event.error;let syntaxError=-1!=a_event.error.toString().indexOf("SyntaxError:");if(syntaxError&&fcf.log.err("fcf","Can't load module",a_event.uri,a_event.error),this._exMode){var selfModule=a_event.uri==this._sourceName;if(selfModule||(selfModule=void 0!==fcf.find(this._modules,function(k,v){return v==a_event.uri})),selfModule){var result=[];for(var key in result.push(a_event.error),this._modules){var moduleName="object"==typeof this._modules[key]?this._modules[key].module:this._modules[key];result.push(fcf.NDetails.amdModules[moduleName].result)}fcf.NDetails.amdEventChannel.detach(this),syntaxError&&delete fcf.NDetails.amdModules[a_event.uri],this._complete=!0,this._callback(result)}}else syntaxError&&delete fcf.NDetails.amdModules[a_event.uri]}},fcf.NDetails._filters={},fcf.loadFilters=(a_typesOrViews=>{if(fcf.isServer())return fcf.actions();let types={},conf=fcf.application.getConfiguration().get("filters"),error=void 0;return fcf.each(a_typesOrViews,(k,v)=>{let type="object"==typeof v?v.type:v;type in fcf.NDetails._filters||(type in conf?types[type]=conf[type]:error=new fcf.Exception("ERROR_INCORRECT_DATA_TYPE",{type:type}))}),fcf.empty(types)?fcf.actions():error?fcf.actions().append(a_act=>{a_act.error(error)}).startup():fcf.actions().asyncEach(types,(a_act,a_type,a_file)=>{fcf.requireEx([a_file],(a_error,a_module)=>{a_error?a_act.error(a_error):(fcf.NDetails._filters[a_type]=new a_module,a_act.complete())})}).startup()}),fcf.getFilter=function(a_typesOrViews){let type="object"==typeof a_typesOrViews?a_typesOrViews.type:a_typesOrViews;if(!(type in fcf.NDetails._filters))throw new fcf.Exception("ERROR_NOT_LOADED_FILTER",{type:type});return fcf.NDetails._filters[type]},fcf.getExtension=(a_path=>{var arr=(a_path=a_path.split("?")[0]).split(".");return arr[arr.length-1]}),fcf.getShortFileName=(a_path=>{for(var offset=0,p=0;p<a_path.length;++p){var c=a_path.charAt(p);":"!=c&&"/"!=c||(offset=p)}return a_path.substr(offset+1).split(".")[0]}),fcf.getFileName=(a_path=>{for(var offset=0,p=0;p<a_path.length;++p){var c=a_path.charAt(p);":"!=c&&"/"!=c||(offset=p)}return offset&&(offset+=1),a_path.substr(offset)}),fcf.getPath=((a_modURI,a_aliases,a_innerServerPath)=>fcf.replaceAll(fcf._getPath(a_modURI,a_aliases,a_innerServerPath,!1),"/./","/")),fcf.getFullPath=((a_modURI,a_aliases,a_innerServerPath)=>fcf.replaceAll(fcf._getPath(a_modURI,a_aliases,a_innerServerPath,!0),"/./","/")),fcf._getPath=((a_modURI,a_aliases,a_innerServerPath,a_fullMode)=>{if("object"!=typeof a_aliases&&(a_innerServerPath=a_aliases,a_aliases=void 0),!a_aliases&&fcf.application){var theme=fcf.application.getThemes().getTheme(void 0,!0);theme&&(a_aliases=theme.getAliases())}if(fcf.empty(a_aliases)&&fcf.application&&(a_aliases=fcf.application.getConfiguration().getConfiguration().aliases),void 0===a_innerServerPath&&(a_innerServerPath=fcf.isServer()),a_innerServerPath){if(":"==a_modURI.charAt(0)){var result=a_modURI.substr(1);return result||"."}}else{if("@"!=a_modURI.charAt(0)&&-1==a_modURI.indexOf(":"))return a_modURI;if(-1!=a_modURI.indexOf("://"))return a_modURI;if(":"==a_modURI.charAt(0))return"/"+a_modURI.substr(1)}if("@"==a_modURI.charAt(0)){var slashPos=a_modURI.indexOf("/"),prefix=-1!=slashPos?a_modURI.substr(0,slashPos):void 0,suffix=-1!=slashPos?a_modURI.substr(slashPos):void 0;prefix&&(a_modURI=prefix);var urlData=fcf.parseUrl(a_modURI),key=urlData.referer.substr(1);a_aliases&&a_aliases[key]&&(a_modURI=fcf.buildUrl(a_aliases[key],urlData.getArgs),a_fullMode&&(a_modURI=a_modURI.split("+")[0])),suffix&&(a_modURI+=suffix)}if(a_innerServerPath){if(0==a_modURI.indexOf("/")||-1!=a_modURI.indexOf("://")||-1!=a_modURI.indexOf(":\\"))return a_modURI}else if(0==a_modURI.indexOf("/")||-1!=a_modURI.indexOf("://"))return a_modURI;fcf.settings.libraries&&fcf.settings.libraries;var modItems=a_modURI.split(":"),libName=modItems.length>1?modItems[0]:"",modName=modItems.length>1?modItems[1]:modItems[0],root=a_innerServerPath?fcf.settings.innerRoot:fcf.settings.outerRoot,libRPath=libName;a_innerServerPath&&fcf.settings.libraries&&libName&&libName in fcf.settings.libraries?libRPath=a_innerServerPath?fcf.settings.libraries[libName].path:"fcfpackages/"+libName:a_innerServerPath||-1===a_modURI.indexOf(":")||(libRPath="fcfpackages/"+libName),a_innerServerPath&&""==libRPath&&(libRPath=".");var libPath=0==libRPath.indexOf("/")||-1!=libRPath.indexOf(":\\")?libRPath:fcf.NPath.concat(root,libRPath);return fcf.NPath.concat(libPath,modName)}),fcf.addModule=((a_name,a_dirPath,a_rootUrl)=>{fcf.settings.libraries[a_name]={url:a_rootUrl,path:a_dirPath}}),fcf.getModules=(()=>fcf.settings.libraries),fcf.getModule=(a_moduleName=>fcf.NDetails.amdModules[a_moduleName].module),fcf.require=((a_modules,a_func)=>{new fcf.NDetails.amdLoader(!1,a_modules,a_result=>{a_func&&a_func.apply(void 0,a_result)}).load()}),fcf.requireEx=((a_modules,a_options,a_func)=>{"function"==typeof a_options&&(a_func=a_options,a_options=void 0),a_options||(a_options={}),new fcf.NDetails.amdLoader(!1,a_modules,a_options,a_result=>{a_func&&a_func.apply(void 0,a_result)},!0).load()}),fcf.module=(a_module=>{if(a_module.name in fcf.NDetails.amdModules||(fcf.NDetails.amdModules[a_module.name]={}),fcf.NDetails.amdLastModulesName=a_module.name,fcf.NDetails.amdModules[a_module.name].state="loaded",fcf.NDetails.amdModules[a_module.name].module=a_module,fcf.isServer()){var fullPath=fcf.getPath(a_module.name);fcf.NDetails.amdModules[fullPath]=fcf.NDetails.amdModules[a_module.name]}var dependencies=a_module.dependencies?a_module.dependencies:[];new fcf.NDetails.amdLoader(a_module.name,dependencies,function(a_result){fcf.NDetails.amdModules[a_module.name].state="ok",a_module.result=a_module.module.apply(a_module,a_result),fcf.NDetails.amdModules[a_module.name].result=a_module.result,fcf.NDetails.amdEventChannel.send({name:"fullload",uri:a_module.name})}).load()}),fcf.prepareObject(fcf,"NFSQL"),fcf.prepareObject(fcf,"NDetails"),fcf.getProjection=(a_propjection=>fcf.application.getProjections().get(a_propjection)),fcf.NDetails.clientVariables=void 0,fcf.getSystemVariable=((a_package,a_variable)=>{void 0==a_variable&&(a_variable=a_package.split(":")[1],a_package=a_package.split(":")[0]);let vars=void 0;if(fcf.isServer()?vars=fcf.NTools.cache.get("fcf","variables"):(fcf.NDetails.clientVariables||fcf.loadObject({path:"/fcfpackages/fcf/variables",async:!1}).then(a_data=>{fcf.NDetails.clientVariables=a_data}),vars=fcf.NDetails.clientVariables),vars[a_package])return vars[a_package][a_variable]}),fcf.setSystemVariable=((a_package,a_name,a_value)=>{"object"==typeof a_value&&null!==a_value&&(a_value=JSON.stringify(a_value));var query={type:"update",from:"fcf_variables",values:[{field:"value",value:a_value}],where:[{logic:"and",type:"=",args:[{field:"package"},{value:a_package}]},{logic:"and",type:"=",args:[{field:"name"},{value:a_name}]}]};return fcf.application.getStorage().query({query:query}).then(a_result=>{var value=void 0;if(a_result[0]&&a_result[0][0]){value=a_result[0][0].value;try{"string"!=typeof value||"["!=value.charAt(0)&&"{"!=value.charAt(0)||(value=JSON.parse(value))}catch(e){}}return value})}),fcf.Message=function(a_name,a_message,a_args,a_subMessage){if("string"!=typeof a_message&&(a_subMessage=a_args,a_args=a_message,a_message=""),"string"==typeof arguments[0])if(this.directionalСall=!1,this.name=a_name,this.subEvent=a_subMessage,this._templateMessage=a_message,Array.isArray(a_args)){for(var i=0;i<a_args.length;++i)this[i+1]=a_args[i];this.length=a_args.length}else fcf.append(this,a_args);else fcf.append(this,arguments[0]),delete this.message;this.toString=function(a_enableDefaultLanguage){let lang=a_enableDefaultLanguage&&fcf.isServer()&&fcf.getSystemVariable("fcf","defaultLanguage")?fcf.getSystemVariable("fcf","defaultLanguage"):void 0,message=fcf.t(this._templateMessage,lang);for(var k in this){var arg="object"==typeof this[k]&&null!==this[k]&&"toString"in this[k]?this[k].toString():this[k];message=fcf.replaceAll(message,"${{"+k+"}}$",arg)}if(this.subEvent){var subText="\n"+this.subEvent.toString();fcf.replaceAll(subText,"\n","\n    "),message+=subText}return this.message=message,message},this.message=this.toString()},fcf.NDetails.messages={},fcf.addException=function(a_messageName,a_messageText){fcf.NDetails.messages[a_messageName]=a_messageText},fcf.error=((a_part,a_error,a_throw)=>{fcf.log.err(a_part,a_error)}),fcf.Exception=function(a_messageName,a_args,a_subEvent){var messageTemplate=fcf.NDetails.messages[a_messageName];fcf.Message.call(this,a_messageName,messageTemplate,a_args,a_subEvent);let steckTxt="object"==typeof console&&"function"===console.trace?console.trace():(new Error).stack;if(void 0===steckTxt)try{throw new Error}catch(e){steckTxt=e.stack}this.stackArr=fcf.Exception.parseStack(steckTxt,1)},fcf.Exception.is=function(a_exception,a_name){return"object"==typeof a_exception&&null!==a_exception&&a_exception.name&&a_exception.name==a_name},fcf.Exception.parseStack=function(a_stackTxt,a_startLevel){void 0===a_startLevel&&(a_startLevel=0);for(var result=[],stackArr=a_stackTxt.split("\n"),i=a_startLevel+1;i<stackArr.length;++i){var level={},endPosFunc=stackArr[i].indexOf("("),posInfoArr=stackArr[i].substr(endPosFunc+1,stackArr[i].length-endPosFunc-2).split(":");level.function=stackArr[i].substr(7,endPosFunc-8),level.file=posInfoArr[0],level.line=posInfoArr[posInfoArr.length-2],level.column=posInfoArr[posInfoArr.length-1],result.push(level)}return result},fcf.Event=function(a_name,a_data){this.name=a_name,"object"==typeof a_data&&fcf.append(this,a_data)},fcf.addException("ERROR_404","Page not found ${{address}}$"),fcf.addException("ERROR_TEST_OPEN_DIRECTORY","Unable to open the '${{directory}}$' directory for reading"),fcf.addException("ERROR_TEST_FAILED_EQUAL","The value '${{1}}$' is not equal to '${{2}}$'"),fcf.addException("ERROR_TEST_FAILED_NOT_EQUAL","The value '${{1}}$' must not be equal to ' ${{2}}$'"),fcf.addException("ERROR_TEST_FAILED_EQUAL_OBJECT","The value '${{1}}$' is not equal to '${{2}}$ ' in the '${{3}}$' object"),fcf.addException("ERROR_TEST_FAILED_EQUAL_OBJECT_ITEM_NOT_FOUND","The '${{element}}$' element is missing from the '${{object}}$' object"),fcf.addException("ERROR_TEST_FAILED_EQUAL_OBJECT_ARG2_NOT_OBJECT","Argument 2 is not an object in the object '${{1}}$'"),fcf.addException("ERROR_TEST_FAILED_EQUAL_OBJECT_ARG2_NOT_ARRAY","Argument 2 is not an array in the object  '${{1}}$'"),fcf.addException("ERROR_TEST_FAILED_EQUAL_OBJECT_LENGTH_ARRAY","The array size of the first array (${{1}}$) is not equal to the size of the second (${{2}}$) in the '${{3}}$' object"),fcf.addException("ERROR","${{error}}$"),fcf.addException("ERROR_FILE_NOT_FOUND","File ${{file}}$ not found"),fcf.addException("ERROR_FORM_INPUT","Incorrectly filled out form"),fcf.addException("ERROR_READ_FILE","Failed to read the file ${{1}}$ (${{2}}$)"),fcf.addException("ERROR_READ_NOT_FILE","Failed to read the file ${{1}}$ (The specified path is not a file)"),fcf.addException("ERROR_READ_FORMAT_FILE","Invalid file format ${{file}}$"),fcf.addException("ERROR_INCORRECT_FORMAT_HANDLER","Invalid format of the request handler ${{file}}$"),fcf.addException("ERROR_REQUEST_PARAMETER_NOT_SET","The request parameter ${{1}}$ is not set"),fcf.addException("ERROR_REQUEST_PARAMETER_NOT_VALID","Invalid request parameter format ${{1}}$"),fcf.addException("ERROR_ASYNC_ACTIONS_CLOSED","Adding a method to a completed execution queue"),fcf.addException("ERROR_EVAL_TEMPL","Execution error in the template ${{1}}$[${{2}}$:${{3}}$]"),fcf.addException("ERROR_EVAL_SCRIPT","Execution error in the file ${{1}}$[${{2}}$]"),fcf.addException("ERROR_INCORRECT_TEMPL_REQUEST_WRAPPER","Wrapper request to an unavailable template ${{template}}$"),fcf.addException("ERROR_NOSET_GET_ARG","The required GET request parameter '${{arg}}$' was omitted"),fcf.addException("ERROR_INCORRECT_DATA_TYPE","Invalid data type '${{type}}$'"),fcf.addException("ERROR_NOT_LOADED_FILTER",'Data filter not loaded for "${{type}}$" type use fcf.loadFilter() method'),fcf.addException("ERROR_HTTP_REQUEST_ERROR","HTTP request failed ${{1}}$"),fcf.addException("ERROR_HTTP_REQUEST_OBJECT_FORMAT","The server returned a response not in JSON format (${{data}}$)"),fcf.addException("ERROR_HTTP_ARG_NOT_SET","The '${{arg}}$' argument in the request to the server is not set"),fcf.addException("ERROR_TEMPLATE_VIEWS_NOT_SET_DATA_FILED","The views data field in the ${{template}}$ template is not set"),fcf.addException("ERROR_UNKNOWN_PROJECTION","An unknown '${{projection}}$' projection is requested"),fcf.addException("ERROR_UNKNOWN_FIELD_TYPE","An unknown '${{param}}$' type in '${{projection}}$' projection"),fcf.addException("ERROR_INCORRECT_PROJECTION_PARAM_NOT_SET","The '${{param}}$' parameter for the '${{projection}}$' projection is not set"),fcf.addException("ERROR_UNKNOWN_PROJECTION_IN_JOIN","Projection '${{joinProjection}}$' was not found in the join block for projection '${{projection}}$'"),fcf.addException("ERROR_PROJECTION_UNSET_WHERE","The where block is not set in the '${{projection}}$' projection"),fcf.addException("ERROR_PROJECTION_UNSET_ALIAS","The 'alias' property of field in the '${{projection}}$' projection is not set"),fcf.addException("ERROR_PROJECTION_UNSET_TYPE","The 'type' property of field in the '${{projection}}$' projection is not set"),fcf.addException("ERROR_SAFE_EVAL_ERROR_COMMAND","safeEval() does not allow 'while', 'for', '=>', 'function', 'class' constructs"),fcf.addException("ERROR_SAFE_EVAL_ERROR_LENGTH","the maximum length of safeEval must not exceed ${{length}}$"),fcf.NDetails.safeEnv={},fcf.NDetails.safeEnvIsEmpty=!0,fcf.rebuildEvalEnvironment=(()=>{fcf.NDetails.safeEnv.eval=eval,fcf.NDetails.safeEnv.fcf=fcf.append({},fcf.NDetails.safeFcf),fcf.NDetails.safeEnv.fcf.tools=fcf.append({},fcf.NDetails.safeFcf.tools)}),fcf.NDetails.evalFunctions={},fcf.NDetails.safeEvalResult_findKeyWord=((a_code,a_word,a_nextChar)=>{let pos=a_code.indexOf(a_code,a_word);if(-1==a_code.indexOf(a_code,a_word))return!1;for(pos+=a_word.length;pos<a_code.length;){if(!(a_code.charCodeAt(pos)<=32))return a_nextChar==a_code.charAt(pos);if(void 0==a_nextChar)return!0;++pos}return!1}),fcf.safeEvalResult=((a_evalCode,a_evalEnvironment)=>{let context=fcf.getContext(),safeEnv=context&&context.get("safeEnv")?context.get("safeEnv"):{},result=void 0,func=fcf.NDetails.evalFunctions[a_evalCode];if(!func){let foundErrorCommand=!1;if(foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"while","("),foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"for","("),foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"function"),foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"=>","{"),foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"class"),foundErrorCommand|=fcf.NDetails.safeEvalResult_findKeyWord(a_evalCode,"goto"),foundErrorCommand)throw new fcf.Exception("ERROR_SAFE_EVAL_ERROR_COMMAND");if(a_evalCode.length>512)throw new fcf.Exception("ERROR_SAFE_EVAL_ERROR_LENGTH",{length:512});func=eval("(function fcfsafeEvalResult79323(a_env, a_args){ var result = undefined; with(a_env) { with(a_args) { result = "+a_evalCode+"} }; return result})"),fcf.NDetails.evalFunctions[a_evalCode]=func}return result=func(safeEnv,a_evalEnvironment),fcf.NDetails.safeEnv.getContext=fcf.getContext,result});class FCFScriptExecutor{constructor(){this._funcStorage={},this._dataFuncStorage={}}execute(a_code,a_args,a_file,a_startLine){let self=this,error=void 0;this._execute(a_code,a_args,a_file,a_startLine,function(a_code,a_args){let func=void 0,code=void 0;try{if(self._funcStorage[a_file]&&self._funcStorage[a_file][a_startLine])func=self._funcStorage[a_file][a_startLine].func,code=self._funcStorage[a_file][a_startLine].code;else{code="(function fcfinnerevalfunction(a_args){";for(let key in a_args)code+="var "+key+" = a_args."+key+";";code+=a_code+" })",func=eval(code),self._funcStorage[a_file]||(self._funcStorage[a_file]={}),self._funcStorage[a_file][a_startLine]={func:func,code:code}}func(a_args)}catch(e){error=e}return self=void 0,{code:code,error:error,result:void 0}})}parse(a_code,a_args,a_file,a_startLine){let self=this,error=void 0;return this._execute(a_code,a_args,a_file,a_startLine,function(a_code,a_args){let func=void 0,code=void 0,result=void 0;try{if(self._funcStorage[a_file]&&self._funcStorage[a_file][a_startLine])func=self._funcStorage[a_file][a_startLine].func,code=self._funcStorage[a_file][a_startLine].code;else{code="(function fcfinnerevalfunction(a_args){";for(let key in a_args)code+="var "+key+" = a_args."+key+";";code+="var result = ("+a_code+"); return result; })",func=eval(code),self._funcStorage[a_file]||(self._funcStorage[a_file]={}),self._funcStorage[a_file][a_startLine]={func:func,code:code}}result=func(a_args)}catch(e){error=e}return self=void 0,{code:code,error:error,result:result}})}_execute(a_code,a_args,a_file,a_startLine,a_handler){let handlerResult=a_handler(a_code,a_args);if(handlerResult.error){a_startLine=a_startLine||0;let stack=handlerResult.error.stackArr?handlerResult.error.stackArr:fcf.Exception.parseStack(handlerResult.error.stack),line=void 0;for(let i=0;i<stack.length;++i)if(0==stack[i].file.indexOf("eval at")||0==stack[i].file.indexOf("fcfEvalTmpl7652492")){line=parseInt(stack[i].line)+a_startLine;break}if(fcf.isServer()&&void 0===line){let path=fcf.getPath(":cache/errors/"+fcf.uuid()+".js");try{libFS.writeFileSync(path,handlerResult.code);try{libChildProcess.execSync("fcfnode "+process.cwd()+"/"+path)}catch(e){let beg=e.message.indexOf("js:");if(-1!=beg){let end=e.message.indexOf("\n",beg),strinfo=e.message.substr(beg+3,end-beg-3);(strinfo=fcf.trim(strinfo,")"))&&(line=parseInt(strinfo)+a_startLine)}}try{libFS.unlinkSync(path)}catch(e){}}catch(e){}}throw line=line||a_startLine?line||a_startLine:0,new fcf.Exception("ERROR_EVAL_SCRIPT",[a_file,line],handlerResult.error)}return handlerResult.result}}fcf.scriptExecutor=new FCFScriptExecutor,fcf.NDetails.downloadStorage={},fcf.load=(a_options=>{let clError=(a_error,a_data)=>{if(a_data){try{var obj=JSON.parse(a_data);obj.error&&(a_error.subEvent=fcf.append(new fcf.Exception("ERROR"),obj.error),a_error.toString())}catch(e){a_error.subEvent=new fcf.Exception("ERROR",{error:fcf.tagRemoval(a_data)}),a_error.toString()}}a_options.onResult&&a_options.onResult(a_error,a_data)};return fcf.actions().exec(a_act=>{var path=fcf.getPath(a_options.path,a_options.aliases),resData=void 0;if(fcf.isServer())path=path.split("+")[0],libFS.readFile(path,"utf8",function(a_error,a_data){if(resData=a_data,a_error){var error=new fcf.Exception("ERROR_READ_FILE",[a_options.path,a_error]);clError(error),a_act.error(error)}else a_options.onResult&&a_options.onResult(void 0,resData),a_act.complete(resData)});else{if(fcf.application.getSettings().fileСaching){var extension=fcf.getExtension(a_options.path);if(("js"==extension||"tmpl"==extension)&&fcf.NDetails.downloadStorage[a_options.path])return a_options.onResult&&a_options.onResult(void 0,fcf.NDetails.downloadStorage[a_options.path]),void a_act.complete(fcf.NDetails.downloadStorage[a_options.path])}var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=(()=>{if(4==xmlHttp.readyState)if(200==xmlHttp.status){if(resData=xmlHttp.responseText,fcf.application.getSettings().fileСaching){var extension=fcf.getExtension(a_options.path);"js"!=extension&&"tmpl"!=extension||(fcf.NDetails.downloadStorage[a_options.path]=resData)}a_options.onResult&&a_options.onResult(void 0,resData),a_act.complete(resData)}else{resData=xmlHttp.responseText;let data=fcf.strToObject(resData),error=void 0;"object"==typeof data&&(data._templateMessage?((error=new fcf.Exception).message=void 0,error.toString(),fcf.append(error,data)):data.message&&(error=new fcf.Exception("ERROR",{error:data.message,stack:data.stack}),fcf.append(error,data))),void 0===error&&(error=new fcf.Exception("ERROR_HTTP_REQUEST_ERROR",[xmlHttp.status])),clError(error,resData),a_act.error(error)}}),fcf.empty(a_options.get)||(path=fcf.buildUrl(path,a_options.get));var async=void 0===a_options.async||a_options.async;xmlHttp.open("POST",path,async);const isSendCookie="@"==a_options.path[0]||"/"==a_options.path[0]||0==a_options.path.indexOf(window.location.hostname+":");fcf.empty(a_options.post)?isSendCookie?xmlHttp.send(JSON.stringify({_fcfContext:fcf.getContext()})):xmlHttp.send(null):a_options.post instanceof FormData?xmlHttp.send(a_options.post):(xmlHttp.setRequestHeader("Content-Type","application/json"),isSendCookie?xmlHttp.send(JSON.stringify(fcf.append(a_options.post,{_fcfContext:fcf.getContext()}))):xmlHttp.send(JSON.stringify(a_options.post)))}})}),fcf.loadObject=(a_options=>fcf.actions().exec(a_act=>{fcf.load({path:a_options.path,aliases:a_options.aliases,post:a_options.post,get:a_options.get,async:a_options.async,onResult:(a_error,a_data)=>{"object"!=typeof(a_data=fcf.strToObject(a_data))&&(a_error=new fcf.Exception("ERROR_HTTP_REQUEST_OBJECT_FORMAT",{data:a_data})),a_options.onResult&&a_options.onResult(a_error,a_data),fcf.empty(a_error)?a_act.complete(a_data):a_act.error(a_error)}})})),fcf.parseUrl=(a_url=>{var result={},sep=a_url.indexOf("?");if(-1===sep)result.url=a_url,result.referer=a_url,result.getArgs={};else{var rawQuery=a_url.substr(sep+1);result.referer=a_url.substr(0,sep),result.url=a_url,result.getArgs={};for(var arr=fcf.str(rawQuery).split("&"),i=0;i<arr.length;++i){var val=arr[i].split("=");result.getArgs[decodeURIComponent(fcf.str(val[0]))]=decodeURIComponent(fcf.str(val[1]))}}if("/"==result.referer[0])result.path=result.referer.substr(1),result.server="",result.protocol="";else{var pos=result.referer.indexOf("://");if(-1!==pos){var pos2=result.referer.indexOf("/",pos+3);-1===pos2?(result.path="/",result.server=result.referer.substr(pos+3),result.protocol=result.referer.substr(0,pos)):(result.path=result.referer.substr(pos2),result.server=result.referer.substr(pos+3,pos2-(pos+3)),result.protocol=result.referer.substr(0,pos))}else result.server="",result.protocol="",result.path=result.referer}return result.args=fcf.append({},result.getArgs),result}),fcf.getHistoryItemFromUrl=(a_url=>{var history=fcf.parseUrl(a_url).getArgs.fcfHistory;if(history){var arr=history.split(";");return arr[arr.length-1]}}),fcf.buildUrl=((a_url,a_args)=>{if(fcf.empty(a_args))return a_url;var urlInfo=fcf.parseUrl(a_url);a_url=urlInfo.referer,a_args=fcf.append({},urlInfo.args,a_args);var first=!0;for(var k in a_args)a_url+=first?-1!=a_url.indexOf("?")?"&":"?":"&",a_url+=k,a_url+="=","object"!=typeof a_args[k]?a_url+=encodeURIComponent(fcf.str(a_args[k])):a_url+=encodeURIComponent(JSON.stringify(a_args[k])),first=!1;return a_url}),fcf.link=((a_options,a_aliases)=>{a_options="string"==typeof a_options?{url:a_options}:"object"==typeof a_options?a_options:{},a_aliases||(a_aliases={});var url=fcf.getPath(fcf.str(a_options.url),a_aliases,!1),urlInfo=fcf.parseUrl(url),args=fcf.append({},urlInfo.getArgs);return"fcfHistory"in urlInfo.getArgs&&(args.fcfHistory=urlInfo.getArgs.fcfHistory,"object"==typeof urlInfo.query&&delete urlInfo.query.fcfHistory,url=fcf.buildUrl(urlInfo.referer,urlInfo.getArgs)),a_options.args&&fcf.append(args,a_options.args),a_options.getArgs&&fcf.append(args,a_options.getArgs),(a_options.history||""===a_options.history)&&(args.fcfHistory?args.fcfHistory+=";":args.fcfHistory="",args.fcfHistory+=encodeURIComponent(fcf.getPath(a_options.history,!1))),fcf.buildUrl(urlInfo.referer,args)}),fcf.actions=(a_initializeOptions=>{var result=void 0;return a_initializeOptions instanceof fcf.Actions?result=a_initializeOptions:"undefined"!=typeof Promise&&a_initializeOptions instanceof Promise?(result=new fcf.Actions).exec(a_act=>{a_initializeOptions.then(()=>{a_act.complete()}).catch(a_error=>{a_act.error(a_error)})}):result=new fcf.Actions(a_initializeOptions),result});class fcfActions{constructor(a_initializeOptions){this._stack=[],this._current=void 0,this._error=void 0,this._ecbs=[],this.result=void 0,this._end=!1,this._lastAction=void 0,this._context=fcf.getContext(),this._settings=fcf.append({onComplete:function(){},onError:function(a_error){}},a_initializeOptions)}append(a_cb,a_args){if(!this._error&&!this._end)return this._lastAction={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!1},this._stack.push(this._lastAction),this}appendAC(a_cb,a_args){if(!this._error&&!this._end)return this._lastAction={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!0},this._stack.push(this._lastAction),this}preAppend(a_cb,a_args){if(!this._error&&!this._end){var info={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!1};return this._lastAction||(this._lastAction=info),this._stack.unshift(info),this}}preAppendAC(a_cb,a_args){if(!this._error&&!this._end){var info={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!0};return this._lastAction||(this._lastAction=info),this._stack.unshift(info),this}}postAppend(a_cb,a_args){if(!this._error&&!this._end){if(this._lastAction){let action={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!1};this._lastAction.actions.push(action),this._lastAction=action}else this.append(a_cb,a_args);return this}}postAppendAC(a_cb,a_args){if(!this._error&&!this._end){if(this._lastAction){let action={cb:a_cb,args:a_args,actions:[],id:fcf.genId(),autoComplete:!0};this._lastAction.actions.push(action),this._lastAction=action}else this.append(a_cb,a_args);return this}}exec(a_cb,a_args){return this.append(a_cb,a_args),this.startup(),this}execAC(a_cb,a_args){return this.appendAC(a_cb,a_args),this.startup(),this}preExec(a_cb,a_args){return this.preAppend(a_cb,a_args),this.startup(),this}preExecAC(a_cb,a_args){return this.preAppendAC(a_cb,a_args),this.startup(),this}postExec(a_cb,a_args){return this.postAppend(a_cb,a_args),this.startup(),this}postExecAC(a_cb,a_args){return this.postAppendAC(a_cb,a_args),this.startup(),this}then(a_cb,a_args){return this.appendAC(a_cb,a_args),this.startup(),this}catch(a_cb){return this._error?a_cb&&a_cb(this._error):this._ecbs.push(a_cb),this}preEach(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.preAppend(a_cb,[k,v])}):this.preAppendAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!1};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}})}),this}each(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.append(a_cb,[k,v])}):this.appendAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!1};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}})}),this}asyncEach(a_object,a_cb){let self=this,result=void 0,counter=fcf.count(a_object),error=void 0;return 0==counter?this:(this.append(a_act=>{let subaction={complete:a_result=>{counter||retrun,--counter,void 0!==a_result&&(result=a_result),counter||(error?a_act.error(error):a_act.complete(result))},error:a_error=>{counter||retrun,error=a_error,--counter||(error?a_act.error(error):a_act.complete(result))}};fcf.each(a_object,(k,v)=>{fcf.setContext(self._context);let subRes=a_cb(subaction,k,v);void 0!==subRes&&(result=subRes)})}),this)}eachExec(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.exec(a_cb,[k,v])}):this.execAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!1};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}}),self.startup()}),this}preEachExec(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.preExec(a_cb,[k,v])}):this.preExecAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!1};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}}),self.startup()}),this}eachAC(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.appendAC(a_cb,[k,v])}):this.appendAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!0};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}})}),this}preEachAC(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.preAppendAC(a_cb,[k,v])}):this.preAppendAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){if(!self._error&&!self._end){var action={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!0};self._lastAction||(action=self._lastAction),self._stack.unshift(action)}})}),this}eachExecAC(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.execAC(a_cb,[k,v])}):this.execAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){self._error||self._end||(self._lastAction={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!0},self._stack.unshift(self._lastAction))}),self.startup()}),this}preEachExecAC(a_obj,a_cb){let self=this;return"function"!=typeof a_obj?fcf.foreach(a_obj,function(k,v){self.preExecAC(a_cb,[k,v])}):this.preExecAC(function(){a_obj=a_obj(),fcf.foreach(a_obj,function(k,v){self._error||self._end||(self._lastAction={cb:a_cb,args:[k,v],actions:[],id:fcf.genId(),autoComplete:!0},self._stack.unshift(self._lastAction))}),self.startup()}),this}startup(){if(!this._error&&!this._current)return this._exec(),this}error(a_error){this._error=a_error,"object"==typeof this._settings.onError&&"function"==typeof this._settings.onError.error?this._settings.onError.error(a_error):this._settings.onError(a_error);for(var i=0;i<this._ecbs.length;++i)this._ecbs[i](this._error)}_exec(){let self=this;if(0!=this._stack.length){var action={_end:!1,complete:function(a_value){this._end||(this._end=!0,self.result=a_value,fcf.each(self._current.actions,function(a_key,a_action){self._lastAction=a_action,self._stack.push(a_action)}),self._current=void 0,self._error||self._exec())},error:function(a_error){if(!this._end){this._end=!0,self._end=!0,self._error=a_error,"object"==typeof self._settings.onError&&"function"==typeof self._settings.onError.error?self._settings.onError.error(a_error):self._settings.onError(a_error);for(var i=0;i<self._ecbs.length;++i)self._ecbs[i](self._error)}}},current=this._current=this._stack.shift(),startArgs=current.autoComplete?[]:[action],args=fcf.append(startArgs,this._current.args);args.push(self.result);var result=void 0;if(fcf.setContext(self._context),"undefined"!=typeof Promise&&self._current.cb instanceof Promise||self._current.cb instanceof fcf.Actions)result=self._current.cb;else try{result=self._current.cb.apply(void 0,args)}catch(error){return void action.error(error)}"undefined"!=typeof Promise&&result instanceof Promise||result instanceof fcf.Actions?(result.then(function(a_res){action.complete(a_res)}),result.catch(function(a_error){action.error(a_error)})):(void 0!==result&&(self.result=result),current.autoComplete&&action.complete(result))}else"object"==typeof self._settings.onComplete&&"function"==typeof self._settings.onError.complete?self._settings.onError.complete():self._settings.onComplete()}}fcf.Actions=fcfActions,fcf.stackDepth=(()=>{for(var c=fcf.stackDepth.caller,depth=0;c&&depth<1e5;)c=c.caller,depth++;return depth}),fcf.getCallStackSize=(()=>{for(var count=0,fn=arguments.callee;fn=fn.caller;)count++;return count}),fcf.isServer()||(fcf.select=((a_node,a_selector)=>{if("string"==typeof a_node)return a_selector=a_node,document.querySelectorAll(a_selector);if(!a_node)return document.querySelectorAll(a_selector);if(!a_node.querySelectorAll)return[];try{return a_node.querySelectorAll(a_selector)}catch(e){if(""==a_node.innerHTML)return[];throw e}})),fcf.RouteInfo=function(a_settings){this.update=function(a_settings){if(this.url="",this.referer="",this.getArgs={},this.postArgs={},this.path="",this.subUri="",this.route="","string"==typeof a_settings&&(a_settings={url:a_settings}),a_settings.url){this.url=a_settings.url;var qi=fcf.parseUrl(a_settings.url);this.getArgs=fcf.append(qi.getArgs,a_settings.getArgs),this.referer=qi.referer,this.path=qi.path,this.uri=fcf.ltrim(this.path,"/"),this.route=this.uri,this.args=a_settings.args?a_settings.args:{},this.url=fcf.link(this.url,this.getArgs)}else if(a_settings.request){var request=a_settings.request.req?a_settings.request.req:a_settings.request;this.url+=request.protocol+"://",this.url+=request.get("host"),this.url+=request.originalUrl;qi=fcf.parseUrl(this.url);this.args=a_settings.args?a_settings.args:{},this.getArgs=fcf.append(qi.getArgs,a_settings.getArgs),this.referer=qi.referer,this.path=qi.path,this.uri=fcf.ltrim(this.path,"/"),fcf.empty(request.body)||(this.postArgs=request.body),this.route=this.uri,this.url=fcf.link(this.url,this.getArgs)}a_settings.route&&this.setRoute(a_settings.route);(a_args=>{for(var k in a_args){var itm=a_args[k];if("string"==typeof itm&&itm.length>=2&&("{"===itm[0]&&"}"===itm[itm.length-1]||"["===itm[0]&&"]"===itm[itm.length-1]))try{a_args[k]=JSON.parse(a_args[k])}catch(e){}else"false"==a_args[k]?a_args[k]=!1:"true"==a_args[k]?a_args[k]=!0:isNaN(a_args[k])||(a_args[k]=parseFloat(a_args[k]))}})(this.getArgs),this.args=this.getArgs,fcf.append(this.args,this.postArgs),this.args.fcfHistory&&(this.backUrl=fcf.getHistoryItemFromUrl(this.url))},this.setRoute=function(a_route){this.route=a_route},this.buildUrl=function(){return fcf.buildUrl(this.path,this.args)},this.update(a_settings)};var Logger=function(){this.TST=0,this.CRH=10,this.ERR=20,this.WRN=30,this.LOG=40,this.INF=50,this.DBG=60,this.TRC=70,this._level=this.LOG,this.getLevel=function(){return this._level},this.setLevel=function(a_level){this._level=a_level},this.tst=function(a_module,a_str){var args=fcf.append([this.TST],arguments);this._logStr.apply(this,args)},this.crh=function(a_module,a_str){var args=fcf.append([this.CRH],arguments);this._logStr.apply(this,args)},this.err=function(a_module,a_str){var args=fcf.append([this.ERR],arguments);this._logStr.apply(this,args)},this.wrn=function(a_module,a_str){var args=fcf.append([this.WRN],arguments);this._logStr.apply(this,args)},this.log=function(a_module,a_str){var args=fcf.append([this.LOG],arguments);this._logStr.apply(this,args)},this.inf=function(a_module,a_str){var args=fcf.append([this.INF],arguments);this._logStr.apply(this,args)},this.dbg=function(a_module,a_str){var args=fcf.append([this.DBG],arguments);this._logStr.apply(this,args)},this.trc=function(){var args=fcf.append([this.TRC],arguments);this._logStr.apply(this,args)},this.write=function(){this._logStr.apply(this,arguments)},this._levelToStr=function(a_level){return a_level<=this.TST?"TST":a_level<=this.CRH?"CRH":a_level<=this.ERR?"ERR":a_level<=this.WRN?"WRN":a_level<=this.LOG?"LOG":a_level<=this.INF?"INF":a_level<=this.DBG?"DBG":"TRC"},this._logStr=function(a_level,a_module){if(!(a_level>this._level)){var output="";output+=(new Date).toISOString().replace(/T/," ").replace(/[A-Za-z]+/,""),output+=" ["+this._levelToStr(a_level)+"]",output+=" [MOD:"+a_module+"]: ";var outputArr=[];outputArr.push(output);for(var i=2;i<arguments.length;++i)fcf.isServer()&&"object"==typeof arguments[i]?arguments[i]instanceof Error?outputArr.push(arguments[i]):arguments[i]instanceof fcf.Exception?(arguments[i].toString(!0),outputArr.push(JSON.stringify(arguments[i],0,2))):outputArr.push(JSON.stringify(arguments[i],0,2)):outputArr.push(arguments[i]);console.log.apply(console,outputArr),fcf.isServer()&&libFS.appendFile("log/log.txt",outputArr.join(" ")+"\r\n","utf-8",function(){})}}};fcf.log=new Logger,fcf.NDetails._wrappers={},fcf.getWrapper=(a_domElementOrId=>{if("object"!=typeof a_domElementOrId)return fcf.NDetails._wrappers[a_domElementOrId];for(var element=a_domElementOrId;element;){if(element.getAttribute("fcftemplate"))return fcf.NDetails._wrappers[element.getAttribute("id")];element=element.parentElement}}),fcf.wasteCollectionForWrappers=function(){},fcf.getWrappersByalias=((a_domElement,a_alias)=>{void 0===a_alias&&(a_alias=a_domElement,a_domElement=document);var items=fcf.select(a_domElement,"[fcfalias="+a_alias+"]"),result=[];return fcf.each(items,function(k,v){var wrp=fcf.getWrapper(v);wrp&&result.push(wrp)}),result}),fcf.arg=((a_type,a_data)=>new fcf.Arg(a_type,a_data)),fcf.argVal=(a_data=>"object"==typeof a_data?new fcf.Arg("value",a_data):new fcf.Arg("value",{value:a_data})),fcf.argRef=((a_id,a_arg)=>"object"==typeof a_id?new fcf.Arg("reference",a_data):new fcf.Arg("reference",{id:a_id,arg:a_arg})),fcf.argTmpl=((a_template,a_data)=>"object"==typeof a_template?new fcf.Arg("reference",a_data):new fcf.Arg("reference",fcf.append({},a_data,{template:a_template}))),fcf.argProg=(a_data=>new fcf.Arg("programmable",a_data)),fcf.isArg=(a_object=>"object"==typeof a_object&&null!==a_object&&a_object["fcf.Arg"]),fcf.Arg=function(a_type,a_data){this["fcf.Arg"]=!0,this.type=a_type,fcf.append(this,a_data),"template"==this.type&&fcf.NDetails.currentTemplate&&"+"==this.template.charAt(0)&&(this.template=fcf.NDetails.currentTemplate.split("+")[0]+this.template)},fcf.RenderResults=function(){this.items=[],this.map=[],this.toString=function(){var result="";return fcf.each(this.items,function(a_key,a_content){result+=a_content}),result}},fcf.NDetails.currentContext=void 0,fcf.NDetails.contextStorage={};class FCFSafeContext{get(a_variableName){let result=fcf.getContext().get(a_variableName);return"safeEnv"==a_variableName?result:"object"==typeof result?fcf.clone(result):result}}if(fcf.isServer()&&(fcf.NDetails.globalObjects=Object.getOwnPropertyNames(_fcfGlobals())),fcf.Context=class{constructor(a_obj){let id="object"==typeof a_obj&&a_obj._id?a_obj._id:fcf.uuid();this._id=id,fcf.NDetails.contextStorage[id]=this,fcf.append(fcf.NDetails.contextStorage[id],a_obj)}destroy(){delete fcf.NDetails.contextStorage[this._id]}get(a_variableName){if(!(this._id in fcf.NDetails.contextStorage))return;if(fcf.isServer()&&"safeEnv"==a_variableName&&!fcf.NDetails.contextStorage[this._id][a_variableName]){let safeEnv={},gv=fcf.NDetails.globalObjects;for(let i=0;i<gv.length;++i)safeEnv[gv[i]]=null;safeEnv.eval=eval,safeEnv.fcf=fcf.append({},fcf.NDetails.safeFcf),this.set("safeEnv",safeEnv)}let value=fcf.NDetails.contextStorage[this._id][a_variableName];return"object"==typeof value?fcf.clone(value):value}set(a_variableName,a_value){this._id in fcf.NDetails.contextStorage&&(fcf.NDetails.contextStorage[this._id][a_variableName]=a_value,fcf.saveContext())}},fcf.getContext=(()=>fcf.NDetails.currentContext),fcf.getSafeContext=(()=>new FCFSafeContext),fcf.setContext=(a_context=>{fcf.NDetails.currentContext=a_context}),fcf.saveContext=(()=>{if(fcf.isServer())return;let sortCtxt=fcf.append({},fcf.NDetails.currentContext);delete sortCtxt.route;let d=new Date;d.setTime(d.getTime()+31536e6);var expires="expires="+d.toUTCString();document.cookie="_fcfContext="+fcf.base64Encode(JSON.stringify(sortCtxt))+"; path=/ ;"+expires}),fcf.NDetails._keyBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",fcf.base64Encode=function(input){var chr1,chr2,chr3,enc1,enc2,enc3,enc4,output="",i=0;for(input=function(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);c<128?utftext+=String.fromCharCode(c):c>127&&c<2048?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext}(input);i<input.length;)enc1=(chr1=input.charCodeAt(i++))>>2,enc2=(3&chr1)<<4|(chr2=input.charCodeAt(i++))>>4,enc3=(15&chr2)<<2|(chr3=input.charCodeAt(i++))>>6,enc4=63&chr3,isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output=output+fcf.NDetails._keyBase64.charAt(enc1)+fcf.NDetails._keyBase64.charAt(enc2)+fcf.NDetails._keyBase64.charAt(enc3)+fcf.NDetails._keyBase64.charAt(enc4);return output},fcf.base64Decode=function(input){var chr1,chr2,chr3,enc2,enc3,enc4,output="",i=0;for(input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");i<input.length;)chr1=fcf.NDetails._keyBase64.indexOf(input.charAt(i++))<<2|(enc2=fcf.NDetails._keyBase64.indexOf(input.charAt(i++)))>>4,chr2=(15&enc2)<<4|(enc3=fcf.NDetails._keyBase64.indexOf(input.charAt(i++)))>>2,chr3=(3&enc3)<<6|(enc4=fcf.NDetails._keyBase64.indexOf(input.charAt(i++))),output+=String.fromCharCode(chr1),64!=enc3&&(output+=String.fromCharCode(chr2)),64!=enc4&&(output+=String.fromCharCode(chr3));return output=function(utftext){for(var string="",i=0,c=c1=c2=0;i<utftext.length;)(c=utftext.charCodeAt(i))<128?(string+=String.fromCharCode(c),i++):c>191&&c<224?(c2=utftext.charCodeAt(i+1),string+=String.fromCharCode((31&c)<<6|63&c2),i+=2):(c2=utftext.charCodeAt(i+1),c3=utftext.charCodeAt(i+2),string+=String.fromCharCode((15&c)<<12|(63&c2)<<6|63&c3),i+=3);return string}(output)},fcf.getRoute=(()=>fcf.getContext().get("route")),fcf.query=function(a_options,a_cb){let storage=fcf.application.getStorage();return storage.query.apply(storage,arguments)},fcf.NDetails._firstCallLiven=!0,fcf.liven=((a_domElement,a_parentIdOrDom,a_cb)=>{if(fcf.NDetails._firstCallLiven){fcf.NDetails._firstCallLiven=!1;let elements=fcf.select("div[fcftemplate]"),templateMap={};for(let i=0;i<elements.length;++i){var path=elements[i].getAttribute("fcftemplate");path&&(templateMap[path]=!0)}let wrappers=[];for(let template in templateMap){var subpart=template.split("+")[1],wrapperPath=template.split("+")[0],url=wrapperPath.substr(0,wrapperPath.length-5)+(subpart?"+"+subpart:"")+".wrapper.js";wrappers.push(url)}fcf.require(wrappers)}"function"==typeof a_domElement?(a_cb=a_domElement,a_domElement=document.body):"function"==typeof a_parentIdOrDom&&(a_cb=a_parentIdOrDom,a_parentIdOrDom=void 0),a_domElement||(a_domElement=document.body);var elements=a_parentIdOrDom?fcf.select(a_domElement,"[fcfparent='"+("object"==typeof a_parentId?a_parentIdOrDom.getAttribute("id"):a_parentIdOrDom)+"'][fcftemplate]"):fcf.select(a_domElement,":not([fcfparent])[fcftemplate]");elements=a_parentIdOrDom?fcf.select(a_domElement,"[fcfparent='"+("object"==typeof a_parentIdOrDom?a_parentIdOrDom.getAttribute("id"):a_parentIdOrDom)+"'][fcftemplate]"):a_domElement.getAttribute("fcftemplate")?[a_domElement]:fcf.select(a_domElement,":not([fcfparent])[fcftemplate]");new fcf.Actions({onComplete:function(){a_cb&&a_cb()},onError:function(a_error){a_cb&&a_cb(a_error)}}).each(elements,function(a_done,a_key,a_element){var object=fcf.NDetails._wrappers[a_element.getAttribute("id")];if(object)return fcf.readOnlyActivate(object.getId()),void object.reattach(function(a_error,a_object){a_error?a_done.error(a_error):a_done.complete()});var template=a_element.getAttribute("fcftemplate"),subpart=template.split("+")[1],wrapperPath=template.split("+")[0],url=wrapperPath.substr(0,wrapperPath.length-5)+(subpart?"+"+subpart:"")+".wrapper.js";fcf.require([url],Wrapper=>{new Wrapper({eventChannel:fcf.application.getEventChannel(),domElement:a_element,onReady:(a_error,a_self)=>{a_error?a_done.error(a_error):a_done.complete()}}).initialize()})}).startup()}),!fcf.isServer()){var oldEPD=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.stopDefault=!0,oldEPD.call(this)}}fcf.NDetails.domListenerCallbacks={},fcf.NDetails.domListener=((a_element,a_eventName,a_event)=>{"object"==typeof a_eventName&&(a_eventName=(a_event=a_eventName).type);var fcfevntid=a_element.getAttribute("fcfevntid");if(fcfevntid&&fcf.NDetails.domListenerCallbacks[fcfevntid]&&fcf.NDetails.domListenerCallbacks[fcfevntid][a_eventName]){for(var callbacks=fcf.NDetails.domListenerCallbacks[fcfevntid][a_eventName],result=void 0,i=0;i<callbacks.length;++i){var r=callbacks[i].cb.call(a_element,a_event);void 0!==r&&(result=r)}return result}}),fcf.emitDomEvent=((a_element,a_name,a_data)=>{if(!fcf.empty(a_element)){var event;if("object"==typeof a_name)a_name=(event=a_name).type,fcf.append(event,a_data);else(event=document.createEvent("Event")).initEvent(a_name,!0,!0),event.name=a_name,event.type||(event.type=a_name),fcf.append(event,a_data);fcf.NDetails.domListener(a_element,a_name,event)}}),fcf.garbageCollector=(()=>{fcf.NDetails._removeDomListenerCallbacks(),fcf.NDetails._removeWrappers()}),fcf.NDetails._removeWrappers=(a_runCyclically=>{for(var id in fcf.NDetails._wrappers)document.getElementById(id)||delete fcf.NDetails._wrappers[id];a_runCyclically&&setTimeout(()=>{fcf.NDetails._removeWrappers(!0)},1e4)}),fcf.addDomListener=((a_element,a_eventName,a_cb)=>{var fcfevntid=a_element.getAttribute("fcfevntid");fcfevntid||(fcfevntid=fcf.genId("fcfevntid"),a_element.setAttribute("fcfevntid",fcfevntid)),fcf.NDetails.domListenerCallbacks[fcfevntid]||(fcf.NDetails.domListenerCallbacks[fcfevntid]={}),fcf.NDetails.domListenerCallbacks[fcfevntid][a_eventName]||(fcf.NDetails.domListenerCallbacks[fcfevntid][a_eventName]=[]),fcf.NDetails.domListenerCallbacks[fcfevntid][a_eventName].push({fcfevntid:fcfevntid,cb:a_cb});var code='return fcf.NDetails.domListener(this, "'+a_eventName+'", event);';a_element.getAttribute("on"+a_eventName)!=code&&a_element.setAttribute("on"+a_eventName,code)}),fcf.NDetails._removeDomListenerCallbacks=(a_runCyclically=>{for(var fcfevntid in fcf.NDetails.domListenerCallbacks){!fcf.empty(fcf.select("[fcfevntid="+fcfevntid+"]"))||(fcf.NDetails.domListenerCallbacks[fcfevntid]._fcfinner_remove?delete fcf.NDetails.domListenerCallbacks[fcfevntid]:fcf.NDetails.domListenerCallbacks[fcfevntid]._fcfinner_remove=!0)}a_runCyclically&&setTimeout(()=>{fcf.NDetails._removeDomListenerCallbacks(!0)},11e3)}),fcf.isServer()||(fcf.NDetails._removeDomListenerCallbacks(!0),fcf.NDetails._removeWrappers(!0)),fcf.getClientRect=(a_element=>{return a_element.getBoundingClientRect()}),fcf.getHiddenContainer=(()=>{var element=document.getElementById("__fcf_hidden_container__");return element||((element=document.createElement("div")).classList.add("fcf-hidden"),document.body.appendChild(element)),element}),fcf.readOnlyActivate=(a_id=>{var element=document.getElementById(a_id),roelement=fcf.select(element,"[name=fcf-readonly]")[0];if(element&&roelement){var rect=element.getBoundingClientRect();roelement.style.display="block",roelement.style.position="absolute",roelement.style.height=rect.height+12,roelement.style.width=rect.width+5}}),fcf.NDetails._includes={},fcf.include=((a_fileOrFiles,a_cb)=>{for(var files=Array.isArray(a_fileOrFiles)?a_fileOrFiles:[a_fileOrFiles],actions=new fcf.Actions({onComplete:function(){a_cb()},onError:function(a_error){a_cb(a_error)}}),i=0;i<files.length;++i){var file=files[i],url=fcf.getPath(file);if(!(url in fcf.NDetails._includes)){if("css"==extension){var elements=fcf.select(document.head,"link");for(i=0;i<elements.length;++i)if(elements[i].href==url){fcf.NDetails._includes[url]=!0;break}}else if("js"==extension)for(elements=fcf.select(document.head,"script"),i=0;i<elements.length;++i)if(elements[i].src==url){fcf.NDetails._includes[url]=!0;break}if(!(url in fcf.NDetails._includes)){fcf.NDetails._includes[url]=!0;var extension=fcf.getExtension(file).toLowerCase();"css"==extension&&(url=>{actions.append(a_act=>{var element=document.createElement("link");element.rel="stylesheet",element.type="text/css",element.media="all",element.href=url,element.onload=(()=>{a_act.complete()}),element.onerror=(()=>{a_act.complete()}),document.head.appendChild(element)})})(url),"js"==extension&&(url=>{actions.append(a_act=>{var element=document.createElement("script");element.src=url,element.onload=(()=>{a_act.complete()}),element.onerror=(()=>{a_act.complete()}),document.head.appendChild(imported)})})(url)}}}actions.startup()}),fcf.locker=(a_options=>{var args={};void 0!==a_options.context&&(args.context=a_options.context),fcf.empty(a_options.selector)||(args.lockSelector=a_options.selector),fcf.application.render({template:"fcfControls:templates/locker.tmpl",owner:document.body,timeout:500,args:args,onResult:(a_error,a_template)=>{a_options.onResult&&a_options.onResult(a_error,a_template)}})}),fcf.lz=function(){var f=String.fromCharCode,keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",baseReverseDic={};function getBaseValue(alphabet,character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(var i=0;i<alphabet.length;i++)baseReverseDic[alphabet][alphabet.charAt(i)]=i}return baseReverseDic[alphabet][character]}var LZString={compressToBase64:function(input){if(null==input)return"";var res=LZString._compress(input,6,function(a){return keyStrBase64.charAt(a)});switch(res.length%4){default:case 0:return res;case 1:return res+"===";case 2:return res+"==";case 3:return res+"="}},decompressFromBase64:function(input){return null==input?"":""==input?null:LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrBase64,input.charAt(index))})},compressToUTF16:function(input){return null==input?"":LZString._compress(input,15,function(a){return f(a+32)})+" "},decompressFromUTF16:function(compressed){return null==compressed?"":""==compressed?null:LZString._decompress(compressed.length,16384,function(index){return compressed.charCodeAt(index)-32})},compressToUint8Array:function(uncompressed){for(var compressed=LZString.compress(uncompressed),buf=new Uint8Array(2*compressed.length),i=0,TotalLen=compressed.length;i<TotalLen;i++){var current_value=compressed.charCodeAt(i);buf[2*i]=current_value>>>8,buf[2*i+1]=current_value%256}return buf},decompressFromUint8Array:function(compressed){if(null===compressed||void 0===compressed)return LZString.decompress(compressed);for(var buf=new Array(compressed.length/2),i=0,TotalLen=buf.length;i<TotalLen;i++)buf[i]=256*compressed[2*i]+compressed[2*i+1];var result=[];return buf.forEach(function(c){result.push(f(c))}),LZString.decompress(result.join(""))},compressToEncodedURIComponent:function(input){return null==input?"":LZString._compress(input,6,function(a){return keyStrUriSafe.charAt(a)})},decompressFromEncodedURIComponent:function(input){return null==input?"":""==input?null:(input=input.replace(/ /g,"+"),LZString._decompress(input.length,32,function(index){return getBaseValue(keyStrUriSafe,input.charAt(index))}))},compress:function(uncompressed){return LZString._compress(uncompressed,16,function(a){return f(a)})},_compress:function(uncompressed,bitsPerChar,getCharFromInt){if(null==uncompressed)return"";var i,value,ii,context_dictionary={},context_dictionaryToCreate={},context_c="",context_wc="",context_w="",context_enlargeIn=2,context_dictSize=3,context_numBits=2,context_data=[],context_data_val=0,context_data_position=0;for(ii=0;ii<uncompressed.length;ii+=1)if(context_c=uncompressed.charAt(ii),Object.prototype.hasOwnProperty.call(context_dictionary,context_c)||(context_dictionary[context_c]=context_dictSize++,context_dictionaryToCreate[context_c]=!0),context_wc=context_w+context_c,Object.prototype.hasOwnProperty.call(context_dictionary,context_wc))context_w=context_wc;else{if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),context_dictionary[context_wc]=context_dictSize++,context_w=String(context_c)}if(""!==context_w){if(Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)){if(context_w.charCodeAt(0)<256){for(i=0;i<context_numBits;i++)context_data_val<<=1,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++;for(value=context_w.charCodeAt(0),i=0;i<8;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}else{for(value=1,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value=0;for(value=context_w.charCodeAt(0),i=0;i<16;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1}0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++),delete context_dictionaryToCreate[context_w]}else for(value=context_dictionary[context_w],i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;0==--context_enlargeIn&&(context_enlargeIn=Math.pow(2,context_numBits),context_numBits++)}for(value=2,i=0;i<context_numBits;i++)context_data_val=context_data_val<<1|1&value,context_data_position==bitsPerChar-1?(context_data_position=0,context_data.push(getCharFromInt(context_data_val)),context_data_val=0):context_data_position++,value>>=1;for(;;){if(context_data_val<<=1,context_data_position==bitsPerChar-1){context_data.push(getCharFromInt(context_data_val));break}context_data_position++}return context_data.join("")},decompress:function(compressed){return null==compressed?"":""==compressed?null:LZString._decompress(compressed.length,32768,function(index){return compressed.charCodeAt(index)})},_decompress:function(length,resetValue,getNextValue){var i,w,bits,resb,maxpower,power,c,dictionary=[],enlargeIn=4,dictSize=4,numBits=3,entry="",result=[],data={val:getNextValue(0),position:resetValue,index:1};for(i=0;i<3;i+=1)dictionary[i]=i;for(bits=0,maxpower=Math.pow(2,2),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;c=f(bits);break;case 2:return""}for(dictionary[3]=c,w=c,result.push(c);;){if(data.index>length)return"";for(bits=0,maxpower=Math.pow(2,numBits),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;switch(c=bits){case 0:for(bits=0,maxpower=Math.pow(2,8),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 1:for(bits=0,maxpower=Math.pow(2,16),power=1;power!=maxpower;)resb=data.val&data.position,data.position>>=1,0==data.position&&(data.position=resetValue,data.val=getNextValue(data.index++)),bits|=(resb>0?1:0)*power,power<<=1;dictionary[dictSize++]=f(bits),c=dictSize-1,enlargeIn--;break;case 2:return result.join("")}if(0==enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++),dictionary[c])entry=dictionary[c];else{if(c!==dictSize)return null;entry=w+w.charAt(0)}result.push(entry),dictionary[dictSize++]=w+entry.charAt(0),w=entry,0==--enlargeIn&&(enlargeIn=Math.pow(2,numBits),numBits++)}}};return LZString}(),fcf.NDetails.safeFcf={arg:fcf.arg,argVal:fcf.argVal,argRef:fcf.argRef,argTmpl:fcf.argTmpl,tools:fcf.tools,isServer:fcf.isServer,id:fcf.id,t:fcf.t,escapeQuotes:fcf.escapeQuotes,escapeChar:fcf.escapeChar,unescape:fcf.unescape,unescapeObject:fcf.unescapeObject,encodeHtml:fcf.encodeHtml,decodeHtml:fcf.decodeHtml,tagRemoval:fcf.tagRemoval,replaceAll:fcf.replaceAll,count:fcf.count,append:fcf.append,clone:fcf.clone,insertBeforeByValue:fcf.insertBeforeByValue,removeByValue:fcf.removeByValue,isEnumerable:fcf.isEnumerable,find:fcf.find,each:fcf.each,map:fcf.map,filter:fcf.filter,array:fcf.array,max:fcf.max,min:fcf.min,range:fcf.range,inc:fcf.inc,first:fcf.first,inc:fcf.inc,first:fcf.first,firstKey:fcf.firstKey,first2:fcf.first2,last:fcf.last,last2:fcf.last2,byteCount:fcf.byteCount,empty:fcf.empty,in:fcf.in,indexOfAll:fcf.indexOfAll,splitSpace:fcf.splitSpace,ltrim:fcf.ltrim,rtrim:fcf.rtrim,trim:fcf.trim,str:fcf.str,merge:fcf.merge,getModeObject:fcf.getModeObject,buildModeObject:fcf.buildModeObject,cutMode:fcf.cutMode,getMode:fcf.getMode,unslash:fcf.unslash,normalizeObjectAddress:fcf.normalizeObjectAddress,resolve:fcf.resolve,resolveEx:fcf.resolveEx,uuid:fcf.uuid,genId:fcf.genId,hash:fcf.hash,equal:fcf.equal,parseUrl:fcf.parseUrl,buildUrl:fcf.buildUrl,getPath:fcf.getPath,getSystemVariable:(a_package,a_variable)=>fcf.clone(fcf.getSystemVariable(a_package,a_variable)),getProjection:a_projetion=>fcf.clone(fcf.getProjection(a_projetion)),getContext:fcf.getSafeContext},"undefined"!=typeof module&&(module.exports=fcf),"undefined"!=typeof global&&(global.fcf=fcf),"undefined"!=typeof window&&(window.fcf=fcf),fcf.isServer()?fcf.addModule("fcf",__dirname,"fcfpackages/fcf"):fcf.addModule("fcf","","fcfpackages/fcf")}();